!function(t){"use strict";function s(){var s=t(".task:not(.task--add)").length,a=t('.task:not(.task--add)[data-completed="1"]').length;if(s>0)var e=100*a/s/100;else var e=0;i.find(".list__progress").css({"-webkit-transform":"scaleX("+e+")",transform:"scaleX("+e+")"})}function a(){for(var t="",s="0123456789abcdefghijklmnopqrstuvwxyz",a=0;a<8;a++)t+=s.charAt(Math.floor(Math.random()*s.length));return t}function e(t,s,a){if(1==a)var a=' data-completed="1"';else var a="";return'<div class="task" data-id="'+t+'"'+a+'><div class="task__status"><div class="task__check  js-completed-task"></div></div><div class="task__name"><input class="task__input  js-edit-task" type="text" value="'+s+'"></div><div class="task__options"><div class="task__trash  js-remove-task"><svg><use xlink:href="#ei-trash-icon"></use></svg></div></div></div>'}if(!localStorage.getItem("dosho")){var o={tasks:[],settings:{}};localStorage.setItem("dosho",JSON.stringify(o))}/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&t("body").addClass("mobile");var i=t(".list");!function(){if(!t("body").hasClass("mobile")){var s=t(window),a=s.scrollTop(),e=i.offset().top;s.on("scroll",function(){var s=t(this);a=s.scrollTop(),a>=e?i.find(".list__head").addClass("list__head--fixed"):i.find(".list__head").removeClass("list__head--fixed")})}}();var d=t(".list__tasks");!function(){for(var t=JSON.parse(localStorage.getItem("dosho")),a="",o=0;o<t.tasks.length;o++)a+=e(t.tasks[o].id,t.tasks[o].name,t.tasks[o].completed);d.prepend(a),s()}(),function(){if(!t("body").hasClass("mobile")){var s=t(window),a=s.height(),e=s.scrollTop(),o=d.offset().top,i=d.height()-1,n=d.find(".task--add").innerHeight();e+a-n<=o+i&&d.find(".task--add").addClass("task--fixed"),s.on("scroll resize",function(){var s=t(this);e=s.scrollTop(),a=s.height(),o=d.offset().top,i=d.height()-1,e+a-n<=o+i?d.find(".task--add").addClass("task--fixed"):d.find(".task--add").removeClass("task--fixed")})}}(),function(){t("body").hasClass("mobile")||d.find(".js-add-task").focus(),d.find(".js-add-task").focusin(function(){var s=t(this);s.parents(".task--add").addClass("task--focus")}),d.find(".js-add-task").focusout(function(){t(this);t(this).parents(".task--add").removeClass("task--focus")})}(),function(){d.on("click",".js-completed-task",function(){var a=t(this),e=a.parents(".task").attr("data-id"),o=a.parents(".task").attr("data-completed"),i=JSON.parse(localStorage.getItem("dosho")),d=i.tasks.filter(function(t){return t.id==e}),n=i.tasks.indexOf(d[0]);if(o)delete i.tasks[n].completed,delete i.tasks[n].completedTime,a.parents(".task").removeAttr("data-completed");else{var r=(new Date).getTime();i.tasks[n].completed=1,i.tasks[n].completedTime=r,a.parents(".task").attr("data-completed",1)}localStorage.setItem("dosho",JSON.stringify(i)),s()})}(),function(){d.on("click",".js-remove-task",function(){var a=t(this),e=a.parents(".task").attr("data-id"),o=JSON.parse(localStorage.getItem("dosho")),i=o.tasks.filter(function(t){return t.id==e}),n=o.tasks.indexOf(i[0]);if(o.tasks.splice(n,1),localStorage.setItem("dosho",JSON.stringify(o)),a.parents(".task").remove(),0==d.find(".task:not(.task--add)").length&&d.find(".js-add-task").focus(),s(),!t("body").hasClass("mobile")&&d.find(".task--add").hasClass("task--fixed")){var r=t(window),l=r.height(),f=r.scrollTop(),c=d.offset().top,k=d.height()-1,h=d.find(".task--add").innerHeight();f+l-h>c+k&&d.find(".task--add").removeClass("task--fixed")}})}(),function(){d.on("keyup change",".js-edit-task",function(s){var a=t(this),e=a.parents(".task").attr("data-id"),o=a.val(),i=JSON.parse(localStorage.getItem("dosho")),d=i.tasks.filter(function(t){return t.id==e}),n=i.tasks.indexOf(d[0]),r=(new Date).getTime();i.tasks[n].name=o,i.tasks[n].lastChange=r,localStorage.setItem("dosho",JSON.stringify(i)),13==s.keyCode&&a.blur()})}(),function(){t(".js-add-task").on("change",function(){var o=t(this),i=o.val(),n=(new Date).getTime(),r=a(),l=JSON.parse(localStorage.getItem("dosho"));l.tasks.push({id:r,name:i,createdTime:n}),localStorage.setItem("dosho",JSON.stringify(l)),o.val(""),d.find(".task--add").before(e(r,i)),s(),t("body").hasClass("mobile")||t("body").scrollTop(1e6)})}()}(jQuery);