!function(a){"use strict";function t(a,t){var e=new Date,s=e.getDay();0==s&&(s=7);var d=1;if(t)for(var i={},r=0;r<t.length;r++){var o=t[r].date;i[o]=t[r].label+"|"+(t[r].completed?1:0)}for(var n="",r=1-s;r<=14-s;r++){var l="",k=new Date,c=k.setDate(e.getDate()+r),f=k.getDate(c),m=k.getMonth(c)+1,g=k.getFullYear(c),u=k.getDay(),h=(f<10?"0"+f:f)+"."+(m<10?"0"+m:m)+"."+g;0==u&&(u=7),e.getDate()==f&&(l+=" grid__date--today",d=0),d&&(l+=" grid__date--past"),6!=u&&7!=u||(l+=" grid__date--holiday"),"task"==a&&(l+=" js-marker-task",i&&h in i&&("bull"==i[h].split("|")[0]&&(l+=" grid__date--bull"),1==i[h].split("|")[1]&&(l+=" grid__date--completed"))),n+='<div class="grid__date'+l+'" data-date="'+h+'">',"list"==a&&(n+=f),n+="</div>"}return n}function e(){var t=a(".task:not(.task--add)").length,e=a(".task--completed").length;if(t>0)var s=100*e/t/100;else var s=0;r.find(".list__progress").css({"-webkit-transform":"scaleX("+s+")",transform:"scaleX("+s+")"})}function s(){for(var a="",t="0123456789abcdefghijklmnopqrstuvwxyz",e=0;e<8;e++)a+=t.charAt(Math.floor(Math.random()*t.length));return a}function d(a,e,s,d){if(1==s)var s=" task--completed";else var s="";return'<div class="task'+s+'" data-id="'+a+'"><div class="task__status"><div class="task__check  js-completed-task"></div></div><div class="task__name">'+e+'</div><div class="task__options"><div class="task__trash  js-remove-task"><svg><use xlink:href="#ei-trash-icon"></use></svg></div></div><div class="task__grid  grid">'+t("task",d)+"</div></div>"}if(!localStorage.getItem("mahoweek")){var i={tasks:[],settings:{}};localStorage.setItem("mahoweek",JSON.stringify(i))}/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&a("body").addClass("mobile");var r=a(".list");r.find(".list__grid").html(t("list")),function(){if(!a("body").hasClass("mobile")){var t=a(window),e=t.scrollTop(),s=r.offset().top;t.on("scroll",function(){var t=a(this);e=t.scrollTop(),e>=s?r.find(".list__head").addClass("list__head--fixed"):r.find(".list__head").removeClass("list__head--fixed")})}}();var o=a(".list__tasks");!function(){for(var a=JSON.parse(localStorage.getItem("mahoweek")),t="",s=0;s<a.tasks.length;s++)t+=d(a.tasks[s].id,a.tasks[s].name,a.tasks[s].completed,a.tasks[s].markers);o.prepend(t),e()}(),o.find(".task--add .task__grid").html(t()),function(){if(!a("body").hasClass("mobile")){var t=a(window),e=t.height(),s=t.scrollTop(),d=o.offset().top,i=o.height()-1,r=o.find(".task--add").innerHeight();s+e-r<=d+i&&o.find(".task--add").addClass("task--fixed"),t.on("scroll resize",function(){var t=a(this);s=t.scrollTop(),e=t.height(),d=o.offset().top,i=o.height()-1,s+e-r<=d+i?o.find(".task--add").addClass("task--fixed"):o.find(".task--add").removeClass("task--fixed")})}}(),function(){a("body").hasClass("mobile")||o.find(".js-add-task").focus(),o.find(".js-add-task").focusin(function(){var t=a(this);t.parents(".task--add").addClass("task--focus")}),o.find(".js-add-task").focusout(function(){var t=a(this);t.parents(".task--add").removeClass("task--focus")})}(),function(){a(".js-add-task").on("change",function(){var t=a(this),i=t.val(),r=(new Date).getTime(),n=s(),l=JSON.parse(localStorage.getItem("mahoweek"));l.tasks.push({id:n,name:i,createdTime:r}),localStorage.setItem("mahoweek",JSON.stringify(l)),t.val(""),o.find(".task--add").before(d(n,i)),e(),a("body").hasClass("mobile")||a("body").scrollTop(1e4)})}(),function(){o.on("click",".js-completed-task",function(){var t=a(this),s=t.parents(".task"),d=s.attr("data-id"),i=s.hasClass("task--completed"),r=s.find(".grid__date--today").attr("data-date"),o=JSON.parse(localStorage.getItem("mahoweek")),n=o.tasks.filter(function(a){return a.id==d}),l=o.tasks.indexOf(n[0]);if(i){var k="del";s.find(".grid__date--today").removeClass("grid__date--completed"),delete o.tasks[l].completed,delete o.tasks[l].completedTime,s.removeClass("task--completed")}else{if(s.find(".grid__date--today").toggleClass("grid__date--completed"),s.find(".grid__date--today").hasClass("grid__date--completed"))var k="add";else var k="del";if(s.find(".grid__date--today").nextAll(".grid__date--bull").length<=1){s.find(".grid__date--today").addClass("grid__date--completed"),k="add";var c=(new Date).getTime();o.tasks[l].completed=1,o.tasks[l].completedTime=c,s.addClass("task--completed")}}if("add"!=k||o.tasks[l].markers){var f=o.tasks[l].markers.filter(function(a){return a.date==r});if(""!=f){var m=o.tasks[l].markers.indexOf(f[0]);"add"==k?o.tasks[l].markers[m].completed=1:o.tasks[l].markers[m].label?delete o.tasks[l].markers[m].completed:o.tasks[l].markers.splice(m,1)}else"add"==k&&o.tasks[l].markers.push({date:r,completed:1})}else o.tasks[l].markers=[{date:r,completed:1}];localStorage.setItem("mahoweek",JSON.stringify(o)),e()})}(),function(){var t=0,e=0,s=a("body").hasClass("mobile")?"touchstart":"mousedown";o.on(s,".task:not(.task--add) .task__name",function(a){if("touchstart"==a.type){var e=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0];t=e.pageX+e.pageY}else t=a.pageX+a.pageY;o.find(".js-add-task").blur()});var d=a("body").hasClass("mobile")?"touchend":"mouseup";o.on(d,".task:not(.task--add) .task__name",function(s){var d=a(this);if("touchend"==s.type){var i=s.originalEvent.touches[0]||s.originalEvent.changedTouches[0];e=i.pageX+i.pageY}else e=s.pageX+s.pageY;if("mouseup"==s.type&&1!=s.which)return!1;if(t==e&&!d.parents(".task").find(".task__input").length){var r=d.text();d.html('<input class="task__input  js-edit-task" type="text" maxlength="100" value="">'),d.parents(".task").find(".task__input").focus().val(r),d.parents(".task").find(".task__input").focusout(function(){d.text(a(this).val())})}})}(),function(){o.on("keyup change",".js-edit-task",function(t){var e=a(this),s=e.parents(".task").attr("data-id"),d=e.val(),i=JSON.parse(localStorage.getItem("mahoweek")),r=i.tasks.filter(function(a){return a.id==s}),o=i.tasks.indexOf(r[0]);i.tasks[o].name=d,localStorage.setItem("mahoweek",JSON.stringify(i)),13==t.keyCode&&e.blur()})}(),function(){o.on("click",".js-remove-task",function(){var t=a(this),s=t.parents(".task").attr("data-id"),d=JSON.parse(localStorage.getItem("mahoweek")),i=d.tasks.filter(function(a){return a.id==s}),r=d.tasks.indexOf(i[0]);if(d.tasks.splice(r,1),localStorage.setItem("mahoweek",JSON.stringify(d)),t.parents(".task").remove(),0==o.find(".task:not(.task--add)").length&&o.find(".js-add-task").focus(),e(),!a("body").hasClass("mobile")&&o.find(".task--add").hasClass("task--fixed")){var n=a(window),l=n.height(),k=n.scrollTop(),c=o.offset().top,f=o.height()-1,m=o.find(".task--add").innerHeight();k+l-m>c+f&&o.find(".task--add").removeClass("task--fixed")}})}(),function(){o.on("click",".task:not(.task--completed) .js-marker-task:not(.grid__date--past):not(.grid__date--completed)",function(){var t=a(this),e=t.parents(".task").attr("data-id"),s=t.attr("data-date"),d=JSON.parse(localStorage.getItem("mahoweek")),i=d.tasks.filter(function(a){return a.id==e}),r=d.tasks.indexOf(i[0]);if(d.tasks[r].markers){var o=d.tasks[r].markers.filter(function(a){return a.date==s});if(""!=o){var n=d.tasks[r].markers.indexOf(o[0]);d.tasks[r].markers.splice(n,1),t.removeClass("grid__date--bull")}else d.tasks[r].markers.push({date:s,label:"bull"}),t.addClass("grid__date--bull")}else d.tasks[r].markers=[{date:s,label:"bull"}],t.addClass("grid__date--bull");localStorage.setItem("mahoweek",JSON.stringify(d))})}(),function(){Sortable.create(document.querySelector(".list__tasks"),{delay:200,animation:0,filter:".task--add, .task__input",preventOnFilter:!1,ghostClass:"task--ghost",chosenClass:"task--chosen",dragClass:"task--drag",scrollSensitivity:80,onChoose:function(){o.addClass("list__tasks--drag")},onEnd:function(a){if(Number.isInteger(a.oldIndex)&&Number.isInteger(a.newIndex)&&a.oldIndex!=a.newIndex){var t=JSON.parse(localStorage.getItem("mahoweek")),e=t.tasks.splice(a.oldIndex,1)[0];void 0!==e?(t.tasks.splice(a.newIndex,0,e),localStorage.setItem("mahoweek",JSON.stringify(t)),o.removeClass("list__tasks--drag")):location.reload()}}})}()}(jQuery);