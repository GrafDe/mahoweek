!function(e){"use strict";function t(){if(C){var t="favicon-32x32.png?v=3",a="img/favicon-today.png?v=2";e("link[rel$=icon]").remove();var s=JSON.parse(localStorage.getItem("mahoweek")),i=s.settings.faviconCounter,n=T.find(".task--today").length;n>0&&i===!0?(e("head").append(e('<link rel="icon" type="image/png" sizes="32x32">').attr("href",a)),Tinycon.setBubble(n<=9?n:"9+")):e("head").append(e('<link rel="icon" type="image/png" sizes="32x32">').attr("href",t))}}function a(){for(var e="",t="0123456789abcdefghijklmnopqrstuvwxyz",a=0;a<8;a++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function s(e){var t=new Date(e),a=t.getDate(),s=t.getMonth()+1,i=t.getFullYear(),n=t.getHours(),o=t.getMinutes(),r=(a<10?"0"+a:a)+"."+(s<10?"0"+s:s)+"."+i+" в "+(n<10?"0"+n:n)+":"+(o<10?"0"+o:o);return r}function i(t){t.settings.updatedTime=(new Date).getTime(),localStorage.setItem("mahoweek",JSON.stringify(t)),firebase.auth().currentUser&&(e(".sync__message").html("").hide(),e(".sync__ava, .menu__ava").attr("data-sync","process"),firebase.database().ref("users/"+firebase.auth().currentUser.uid+"/database").set({lists:t.lists,tasks:t.tasks,settings:t.settings}).then(function(){e(".sync__updated span").text(s(t.settings.updatedTime)),e(".sync__ava, .menu__ava").attr("data-sync","ok")}).catch(function(t){e(".sync__ava, .menu__ava").attr("data-sync","fail"),console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()}))}function n(t){return firebase.database().ref("/users/"+t+"/database").once("value").then(function(a){if(null===a.val()){var s=JSON.parse(localStorage.getItem("mahoweek"));firebase.database().ref("users/"+t+"/database").set({lists:s.lists,tasks:s.tasks,settings:s.settings}).then(function(){localStorage.setItem("authorizedUser",!0),window.location.reload(!0)}).catch(function(t){console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()})}else{var i={lists:void 0!==a.val().lists?a.val().lists:[],tasks:void 0!==a.val().tasks?a.val().tasks:[],settings:a.val().settings};localStorage.setItem("mahoweek",JSON.stringify(i)),localStorage.setItem("authorizedUser",!0),window.location.reload(!0)}}).catch(function(t){console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()})}function o(e,t){var a={"2018-02-02":{icon:"🐹",title:"День сурка",dayoff:!1},"2018-02-12":{icon:"🌞",title:"Масленица",dayoff:!1},"2018-02-14":{icon:"❤",title:"День всех влюблённых",dayoff:!1},"2018-02-22":{title:"Сокращённый рабочий день",dayoff:!1},"2018-02-23":{icon:"💪",title:"День защитника Отечества, праздничный день",dayoff:!0},"2018-03-01":{icon:"🌷",title:"Первый день весны",dayoff:!1},"2018-03-07":{title:"Сокращённый рабочий день",dayoff:!1},"2018-03-08":{icon:"👩",title:"Международный женский день, праздничный день",dayoff:!0},"2018-03-09":{title:"Праздничный день (выходной за счёт 6-го января)",dayoff:!0},"2018-03-17":{icon:"🍀",title:"День святого Патрика",dayoff:!1},"2018-04-08":{icon:"🐇",title:"Пасха",dayoff:!1},"2018-04-13":{icon:"😈",title:"Пятница 13",dayoff:!1},"2018-07-13":{icon:"😈",title:"Пятница 13",dayoff:!1}},s=new Date,i=s.getDay();0==i&&(i=7);var n=1;if(t)for(var o={},r=0;r<t.length;r++){var l=t[r].date;o[l]=t[r].label+"|"+(t[r].completed?1:0)}for(var d="",r=1-i;r<=14-i;r++){var c="",f=new Date,u=f.setDate(s.getDate()+r),g=f.getDate(u),m=f.getMonth(u)+1,h=f.getFullYear(u),_=f.getDay(),p=h+"-"+(m<10?"0"+m:m)+"-"+(g<10?"0"+g:g);s.getDate()==g&&(c+=" grid__date--today",n=0),n&&(c+=" grid__date--past"),"list"==e?p in a?((6==_||0==_||a[p].dayoff)&&(c+=" grid__date--holiday"),d+='<div class="grid__date'+c+'" title="'+a[p].title+'">'+(void 0!==a[p].icon?a[p].icon:g)+"</div>"):(6!=_&&0!=_||(c+=" grid__date--holiday"),d+='<div class="grid__date'+c+'">'+g+"</div>"):"task"==e?(o&&p in o&&("bull"==o[p].split("|")[0]&&(c+=" grid__date--bull"),1==o[p].split("|")[1]&&(c+=" grid__date--completed")),d+=n?'<div class="grid__date'+c+'"></div>':'<button type="button" class="grid__date  js-marker-task'+c+'" data-date="'+p+'" aria-label="Добавить или снять метку" ></button>'):"add-task"==e&&(d+='<div class="grid__date'+c+'"></div>')}return d}function r(){for(var e="",t=JSON.parse(localStorage.getItem("mahoweek")),a=0;a<t.lists.length;a++)e+=f(t.lists[a].id,t.lists[a].name);T.prepend(e),T.find(".list__grid").html(o("list")),T.find(".task__grid").html(o("add-task")),l()}function l(){Sortable.create(document.querySelector(".board__lists"),{delay:S,animation:S,handle:".list__name",filter:".list__input",preventOnFilter:!1,ghostClass:"list--ghost",chosenClass:"list--chosen",dragClass:"list--drag",forceFallback:!0,fallbackClass:"list--fallback",fallbackOnBody:!0,scrollSensitivity:100,onChoose:function(){T.addClass("board__lists--drag")},onEnd:function(){T.removeClass("board__lists--drag")},onSort:function(e){var t=JSON.parse(localStorage.getItem("mahoweek")),a=t.lists.splice(e.oldIndex,1)[0];t.lists.splice(e.newIndex,0,a),i(t)}})}function d(e){var t=e;return t=/https:\/\/mahoweek\.ru\/#/.test(e)?t.replace(/(https:\/\/)(mahoweek\.ru\/#)([\S]+[^ ,\.!])/gi,'<a href="#$3" class="cartonbox" data-cb-type="inline" data-cb-hash="$3"><span class="hidden">$1</span>$2$3</a>'):t.replace(/(http(s)?:\/\/(www\.)?)([\S]+[^ ,\.!])/gi,'<a href="$1$4" class="js-link-task" target="_blank" rel="noopener noreferrer"><span class="hidden">$1</span>$4</a>')}function c(e){var t=T.find('.list[data-id="'+e+'"] .list__tasks .task').length,a=T.find('.list[data-id="'+e+'"] .task--completed').length;if(t>0)var s=100*a/t/100;else var s=0;T.find('.list[data-id="'+e+'"] .list__progress').css({"-webkit-transform":"scaleX("+s+")",transform:"scaleX("+s+")"})}function f(e,t){return'<section class="list" data-id="'+e+'"><div class="list__head"><div class="list__wrap"><div class="list__name  js-name">'+d(t)+'</div><div class="list__options"><button type="button" class="list__trash  js-remove-list" aria-label="Удалить"><svg><use xlink:href="#icon-trash"></use></svg></button></div><div class="list__progress"></div></div><div class="list__grid  grid"></div></div><div class="list__tasks"></div><div class="list__foot"><div class="task  task--add"><div class="task__wrap"><label class="task__status" for="'+e+'-add-task" aria-label="Дело"><div class="task__plus"><svg><use xlink:href="#icon-plus"></use></svg></div></label><div class="task__name"><input id="'+e+'-add-task" class="task__input  js-add-task" type="text" maxlength="255"></div></div><div class="task__grid  grid"></div></div></div></section>'}function u(){var a=(new Date).getDay();0==a&&(a=7);var s=new Date;s.setDate(s.getDate()-a),s.setHours(23,59,59,999);for(var n=s.getTime(),o=[],r=JSON.parse(localStorage.getItem("mahoweek")),l=0;l<r.tasks.length;l++)if(!(r.settings.deleteCompletedTasks&&r.tasks[l].completed&&r.tasks[l].completedTime<=n)){o.push(r.tasks[l]),T.find('.list[data-id="'+r.tasks[l].listId+'"] .list__tasks').append(_(r.tasks[l].id,r.tasks[l].name,r.tasks[l].completed,r.tasks[l].markers));var d=T.find('.task[data-id="'+r.tasks[l].id+'"]');m(d)}for(var l=0;l<r.lists.length;l++)c(r.lists[l].id),g(document.querySelectorAll(".list__tasks")[l]);r.tasks.length!=o.length&&(r.tasks=o,i(r)),e("body").addClass("ready"),t()}function g(e){Sortable.create(e,{group:"group",delay:S,animation:100,handle:".task__name",filter:".task__input",preventOnFilter:!1,ghostClass:"task--ghost",chosenClass:"task--chosen",dragClass:"task--drag",forceFallback:!0,fallbackClass:"task--fallback",fallbackOnBody:!0,scrollSensitivity:100,onChoose:function(){T.addClass("board__lists--drag")},onEnd:function(){T.removeClass("board__lists--drag")},onSort:function(e){var t=e.item.parentElement.parentElement.attributes["data-id"].value,a=e.item.attributes["data-id"].value,s=JSON.parse(localStorage.getItem("mahoweek")),n=s.tasks.filter(function(e){return e.id==a}),o=s.tasks.indexOf(n[0]);s.tasks[o].listId=t;var r=s.tasks.splice(o,1)[0];if(0===e.newIndex)s.tasks.splice(0,0,r);else{var l=e.item.previousElementSibling.attributes["data-id"].value,d=s.tasks.filter(function(e){return e.id==l}),c=s.tasks.indexOf(d[0]);s.tasks.splice(c+1,0,r)}i(s)},onAdd:function(e){var t=e.to.parentElement.attributes["data-id"].value;c(t)},onRemove:function(e){var t=e.from.parentElement.attributes["data-id"].value;c(t)}})}function m(e){e.find(".grid__date.grid__date--past.grid__date--bull:not(.grid__date--completed)").length&&!e.find(".grid__date.grid__date--today.grid__date--completed").length&&e.find(".grid__date.grid__date--past.grid__date--bull:not(.grid__date--completed):last").index()>e.find(".grid__date.grid__date--past.grid__date--completed:last").index()?e.addClass("task--past"):e.removeClass("task--past"),e.find(".grid__date:not(.grid__date--past):not(.grid__date--completed).grid__date--bull").length?e.addClass("task--bull"):e.removeClass("task--bull"),e.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length?e.addClass("task--today"):e.removeClass("task--today")}function h(e){var t=e;return t=/https:\/\/mahoweek\.ru\/#/.test(e)?t.replace(/(https:\/\/)(mahoweek\.ru\/#)([\S]+[^ ,\.!])/gi,'<a href="#$3" class="cartonbox" data-cb-type="inline" data-cb-hash="$3"><span class="hidden">$1</span>$2$3</a>'):t.replace(/(http(s)?:\/\/(www\.)?)([\S]+[^ ,\.!])/gi,'<a href="$1$4" class="js-link-task" target="_blank" rel="noopener noreferrer"><span class="hidden">$1</span>$4</a>'),t=t.replace(/(.+)?(\s)?((2[0-3]|[0-1]\d):([0-5]\d))(\s)?(.+)?/gi,'<span class="task__time">$3</span> $1$7').trim(),/[!]{1,}/.test(e)&&(t="<strong>"+t+"</strong>"),t}function _(e,t,a,s){if(1==a)var a=" task--completed";else var a="";return'<div class="task'+a+'" data-id="'+e+'"><div class="task__wrap"><div class="task__status"><button type="button" class="task__check  js-completed-task" aria-label="Отметить"></button></div><div class="task__name  js-name">'+h(t)+'</div><div class="task__options"><button type="button" class="task__trash  js-remove-task" aria-label="Удалить"><svg><use xlink:href="#icon-trash"></use></svg></button></div></div><div class="task__grid  grid">'+o("task",s)+"</div></div>"}const p=(navigator.platform.toUpperCase().indexOf("WIN")!==-1,navigator.platform.toUpperCase().indexOf("MAC")!==-1,navigator.platform.toUpperCase().indexOf("LINUX")!==-1,navigator.userAgent.toLowerCase().indexOf("firefox")>-1),v=/^((?!chrome).)*safari/i.test(navigator.userAgent),k=/chrom(e|ium)(edge)?/.test(navigator.userAgent.toLowerCase()),y=(navigator.userAgent.match("CriOS"),navigator.userAgent.match("MSIE"),navigator.userAgent.match("Edge")),b=(navigator.userAgent.toLowerCase().indexOf("android")>-1,null!==navigator.userAgent.match(/iPad/i),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),w=!!("Notification"in window&&!b&&(y||p||k||v)),C=!(!document.createElement("canvas").getContext||b||!p&&!k),S=200,x=e(".board"),I=x.find(".board__theme"),T=x.find(".board__lists"),O=e(".form--settings");b&&e("body").addClass("mobile"),function(){if(localStorage.getItem("mahoweek")){window.location.search&&window.history.replaceState(null,null,"/");var e=JSON.parse(localStorage.getItem("mahoweek"));I.addClass("board__theme--"+e.settings.theme)}else{localStorage.clear();var t=new Date,s=t.getTime(),i=t.getDate(),n=t.getMonth()+1,o=t.getFullYear(),r=o+"-"+(n<10?"0"+n:n)+"-"+(i<10?"0"+i:i),l=a(),d="leaves",c={lists:[{id:l,name:"Краткосрочный план дел",createdTime:s}],tasks:[{id:a(),listId:l,name:"Прочитать справку о сайте: https://mahoweek.ru/#about!",createdTime:s,markers:[{date:r,label:"bull"}]},{id:a(),listId:l,name:"Посмотреть как здесь всё устроено: https://mahoweek.ru/#tour",createdTime:s,markers:[{date:r,label:"bull"}]},{id:a(),listId:l,name:"21:00 Настроить доску: https://mahoweek.ru/#settings",createdTime:s,markers:[{date:r,label:"bull"}]},{id:a(),listId:l,name:"Добавить ещё дел в список",createdTime:s},{id:a(),listId:l,name:"Наметить на календарной сетке даты выполнения задач",createdTime:s}],settings:{createdTime:s,updatedTime:s,deleteCompletedTasks:!1,faviconCounter:!0,theme:d}};if(window.location.search){var f=window.location.search.replace("?","").split("&").reduce(function(e,t){var a=t.split("=");return e[decodeURIComponent(a[0])]=decodeURIComponent(a[1]),e},{});if("365dayz.ru"==f.src&&f.user){var u=a(),g="Проект «365 дней»: https://365dayz.ru/users/"+f.user+"/";c.lists.push({id:u,name:g,createdTime:s});var m=t.getDay();0==m&&(m=7);for(var h=[],_=0;_<=14-m;_++){var p=new Date,v=p.setDate(t.getDate()+_),k=p.getDate(v),y=p.getMonth(v)+1,b=p.getFullYear(v),w=b+"-"+(y<10?"0"+y:y)+"-"+(k<10?"0"+k:k);h.push({date:w,label:"bull"})}c.tasks.push({id:a(),listId:u,name:"20:00 Загрузить фотографию: https://365dayz.ru/add/",createdTime:s,markers:h},{id:a(),listId:u,name:"Ознакомиться с расширенным аккаунтом: https://365dayz.ru/plus/",createdTime:s},{id:a(),listId:u,name:"Заполнить подробнее профиль: https://365dayz.ru/settings/profile/",createdTime:s})}window.history.replaceState(null,null,"/")}localStorage.setItem("mahoweek",JSON.stringify(c)),I.addClass("board__theme--"+d),""==window.location.hash&&window.location.replace("#hello")}}(),function(){var t=500,a=new Date;setTimeout(function s(){if(e("body").hasClass("ready")){var i=new Date,n=i.getTime(),o=i.getHours(),r=i.getMinutes(),l=(o<10?"0"+o:o)+":"+(r<10?"0"+r:r);if(a.getDay()!=i.getDay())window.location.reload(!0);else{if(w){var d=localStorage.getItem("notify");if(d&&"none"!==d&&"granted"===Notification.permission){var d=1*d;if(9e5===d)var c="15 минут",f=12e4;else if(18e5===d)var c="30 минут",f=3e5;else if(36e5===d)var c="1 час",f=6e5;else if(72e5===d)var c="2 часа",f=9e5;T.find(".task__time").each(function(){var t=e(this),a=t.parents(".task"),s=t.text(),i=a.find(".task__name").text();if(i=i.replace(/((2[0-3]|[0-1]\d):([0-5]\d)) /gi,""),a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length&&s>l)var o=a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").attr("data-date"),r=o+"T"+s+":00";else if(a.find(".grid__date--today + .grid__date--bull").length)var o=a.find(".grid__date--today + .grid__date--bull").attr("data-date"),r=o+"T"+s+":00";if(r&&(!a.attr("data-notify")||a.attr("data-notify")&&a.attr("data-notify")!==r)&&n+d>=Date.parse(r)&&n+d<=Date.parse(r)+f){new Notification("Через "+c+", в "+s,{body:i,icon:"img/notify.png?v=2",requireInteraction:!0});a.attr("data-notify",r),yaCounter43856389.reachGoal("ya-alert-triggered")}if(a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length&&s===l&&!a.hasClass("task--now")){new Notification("Время "+s+"!",{body:i,icon:"img/notify.png?v=2",requireInteraction:!0});a.addClass("task--now"),yaCounter43856389.reachGoal("ya-alert-triggered")}})}}T.find(".task__time").each(function(){var t=e(this),a=t.parents(".task"),s=t.text();a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length&&s<=l?a.addClass("task--now"):a.removeClass("task--now")})}}setTimeout(s,t)},t)}(),function(){var t=0,a=0,s=b?"touchstart":"mousedown";T.on(s,".js-name",function(e){if("touchstart"==e.type){var a=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t=a.pageX+a.pageY}else t=e.pageX+e.pageY});var i=b?"touchend":"mouseup";T.on(i,".js-name",function(s,i){var n=e(this);if("touchend"==s.type){var o=s.originalEvent.touches[0]||s.originalEvent.changedTouches[0];a=o.pageX+o.pageY}else a=s.pageX+s.pageY;if("mouseup"==s.type&&1!=s.which&&"run"!=i)return!1;if(!(e(s.target).hasClass("js-link-task")||e(s.target).hasClass("cartonbox")||t!=a&&"run"!=i)){if(T.removeClass("board__lists--drag"),n.hasClass("list__name")&&!n.parents(".list").find(".list__input").length){var r=n.text();n.html('<input class="list__input  js-edit-list" type="text" maxlength="255" value="">'),n.parents(".list").find(".list__input").val(r).select(),n.parents(".list").scrollLeft(0).css({"overflow-x":"hidden","-webkit-overflow-scrolling":"auto"}),n.parents(".list").find(".list__input").on("focusout",function(){n.html(d(e(this).val())),n.parents(".list").css({"overflow-x":"","-webkit-overflow-scrolling":""})})}if(n.hasClass("task__name")&&!n.parents(".task").find(".task__input").length){var l=n.text();n.html('<input class="task__input  js-edit-task" type="text" maxlength="255" value="">'),n.parents(".task").find(".task__input").val(l).focus(),n.parents(".list").scrollLeft(0).css({"overflow-x":"hidden","-webkit-overflow-scrolling":"auto"}),n.parents(".task").find(".task__input").on("focusout",function(){n.html(h(e(this).val())),n.parents(".list").css({"overflow-x":"","-webkit-overflow-scrolling":""})})}}})}(),function(){var t={speed:S,nav:!1,preload:!1,closeHtml:'<svg><use xlink:href="#icon-close"></use></svg>',onStartBefore:function(){e(".cartonbox-close").attr({role:"button",tabindex:0,"aria-label":"Закрыть"}).prependTo(".cartonbox-container")},onShowBefore:function(){e("body").addClass("modal-open")},onClosedBefore:function(){e("body").removeClass("modal-start"),e("body").removeClass("modal-open"),e("body").addClass("modal-closed")},onClosedAfter:function(){e("body").removeClass("modal-closed")}};e.cartonbox(t),"#hello"===window.location.hash&&e(".js-open-hello").trigger("click"),""!==window.location.hash&&e("body").addClass("modal-start"),e(".js-close-hello").on("click",function(){e(".cartonbox-close").trigger("click")})}(),function(){var e={},t=null,a=null,s=null,i=null,n={},o=Math.ceil(window.devicePixelRatio)||1,r=16*o,l={width:16,height:16,font:11*o+"px Courier New",color:"#000",background:"transparent",fallback:!1,crossOrigin:!0,abbreviate:!0},d=function(){var e=navigator.userAgent.toLowerCase();return function(t){return e.indexOf(t)!==-1}}(),c={ie:d("trident"),chrome:d("chrome"),webkit:d("chrome")||d("safari"),safari:d("safari")&&!d("chrome"),mozilla:d("mozilla")&&!d("chrome")&&!d("safari")},f=function(){for(var e=document.getElementsByTagName("link"),t=0,a=e.length;t<a;t++)if((e[t].getAttribute("rel")||"").match(/\bicon\b/i))return e[t];return!1},u=function(){for(var e=document.getElementsByTagName("link"),t=0,a=e.length;t<a;t++){var s="undefined"!=typeof e[t];s&&(e[t].getAttribute("rel")||"").match(/\bicon\b/i)&&e[t].parentNode.removeChild(e[t])}},g=function(){if(!a||!t){var e=f();t=e?e.getAttribute("href"):"/favicon.ico",a||(a=t)}return t},m=function(){return i||(i=document.createElement("canvas"),i.width=r,i.height=r),i},h=function(e){if(e){u();var t=document.createElement("link");t.type="image/x-icon",t.rel="icon",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}},_=function(e,t){if(!m().getContext||c.ie||c.safari||"force"===n.fallback)return p(e);var a=m().getContext("2d"),t=t||"#000000",i=g();s=document.createElement("img"),s.onload=function(){a.clearRect(0,0,r,r),a.drawImage(s,2,2,s.width,s.height,0,0,r,r),(e+"").length>0&&v(a,e,t),k()},!i.match(/^data/)&&n.crossOrigin&&(s.crossOrigin="anonymous"),s.src=i},p=function(e){if(n.fallback){var t=document.title;"("===t[0]&&(t=t.slice(t.indexOf(" "))),(e+"").length>0?document.title="("+e+") "+t:document.title=t}},v=function(e,t,a){"number"==typeof t&&t>99&&n.abbreviate&&(t=y(t));var s=(t+"").length-1,i=n.width*o+6*o*s,l=n.height*o,d=r-l,f=r-i-o,u=16*o,g=16*o,m=2*o;e.font=(c.webkit?"bold ":"")+n.font,e.fillStyle=n.background,e.strokeStyle=n.background,e.lineWidth=o,e.beginPath(),e.moveTo(f+m,d),e.quadraticCurveTo(f,d,f,d+m),e.lineTo(f,u-m),e.quadraticCurveTo(f,u,f+m,u),e.lineTo(g-m,u),e.quadraticCurveTo(g,u,g,u-m),e.lineTo(g,d+m),e.quadraticCurveTo(g,d,g-m,d),e.closePath(),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.textAlign="right",e.textBaseline="top",e.strokeText(t,2===o?32:16,c.mozilla?7*o:6*o),e.fillStyle=n.color,e.textAlign="right",e.textBaseline="top",e.fillText(t,2===o?32:16,c.mozilla?7*o:6*o)},k=function(){m().getContext&&h(m().toDataURL())},y=function(e){for(var t=[["G",1e9],["M",1e6],["k",1e3]],a=0;a<t.length;++a)if(e>=t[a][1]){e=b(e/t[a][1])+t[a][0];break}return e},b=function(e,t){var a=new Number(e);return a.toFixed(t)};e.setOptions=function(e){n={},e.colour&&(e.color=e.colour);for(var t in l)n[t]=e.hasOwnProperty(t)?e[t]:l[t];return this},e.setImage=function(e){return t=e,k(),this},e.setBubble=function(e,t){return e=e||"",_(e,t),this},e.reset=function(){t=a,h(a)},e.setOptions(l),"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module?module.exports=e:window.Tinycon=e}();var j={apiKey:"AIzaSyBzWqGiMDErDxB_kUOO8-KYABo0_SYNap8",authDomain:"mahoweek-8c3db.firebaseapp.com",databaseURL:"https://mahoweek-8c3db.firebaseio.com"};firebase.initializeApp(j),function(){localStorage.getItem("authorizedUser")?(e(".sync__auth").addClass("sync__auth--hidden"),e(".sync__user").addClass("sync__user--show"),e(".sync__ava, .menu__ava").attr("data-sync","process"),firebase.auth().onAuthStateChanged(function(t){if(t){e(".sync__ava, .menu__ava").css("background-image","url("+t.photoURL+")"),e(".sync__name").text(t.displayName),e(".sync__ava").attr("data-provider",t.providerData[0].providerId),e(".menu__item--settings").addClass("menu__item--profile");var a=0;firebase.database().ref("/users/"+t.uid+"/database").on("value",function(t){if(a++,t.val().settings.updatedTime>JSON.parse(localStorage.getItem("mahoweek")).settings.updatedTime){var i={lists:void 0!==t.val().lists?t.val().lists:[],tasks:void 0!==t.val().tasks?t.val().tasks:[],settings:t.val().settings};localStorage.setItem("mahoweek",JSON.stringify(i)),window.location.reload(!0)}else 1==a&&(e(".sync__updated span").text(s(t.val().settings.updatedTime)),e(".sync__ava, .menu__ava").attr("data-sync","ok"),r(),u())})}else localStorage.clear(),window.location.replace("#bye"),window.location.reload(!0)})):(r(),u())}(),function(){e(".js-login-sync").on("click",function(){var t=e(this);if(e(".sync__message").html("").hide(),e(".sync__auth").addClass("sync__auth--load"),!firebase.auth().currentUser){if("twitter"==t.attr("data-provider"))var a=new firebase.auth.TwitterAuthProvider;else if("facebook"==t.attr("data-provider")){var a=new firebase.auth.FacebookAuthProvider;a.addScope("public_profile"),a.addScope("email")}b?firebase.auth().signInWithRedirect(a):firebase.auth().signInWithPopup(a).then(function(e){n(e.user.uid)}).catch(function(t){e(".sync__auth").removeClass("sync__auth--load"),console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()})}}),firebase.auth().getRedirectResult().then(function(e){e.credential&&n(e.user.uid)}).catch(function(t){e(".sync__auth").removeClass("sync__auth--load"),console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()}),e(".js-logout-sync").on("click",function(){firebase.auth().currentUser&&(e(".sync__message").html("").hide(),firebase.auth().signOut().then(function(){localStorage.clear(),window.location.replace("#bye"),window.location.reload(!0)}).catch(function(t){console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()}))})}(),function(){e(".js-get-sync").on("click",function(){if(firebase.auth().currentUser)return e(".sync__message").html("").hide(),e(".sync__ava, .menu__ava").attr("data-sync","process"),e(".sync__hand").addClass("sync__hand--spin"),firebase.database().ref("/users/"+firebase.auth().currentUser.uid+"/database").once("value").then(function(t){var a=JSON.parse(localStorage.getItem("mahoweek"));if(t.val().settings.updatedTime>=a.settings.updatedTime){var s={lists:void 0!==t.val().lists?t.val().lists:[],tasks:void 0!==t.val().tasks?t.val().tasks:[],settings:t.val().settings};localStorage.setItem("mahoweek",JSON.stringify(s)),yaCounter43856389.reachGoal("ya-manually-sync"),window.location.reload(!0)}else firebase.database().ref("users/"+firebase.auth().currentUser.uid+"/database").set({lists:a.lists,tasks:a.tasks,settings:a.settings}).then(function(){e(".sync__ava, .menu__ava").attr("data-sync","ok"),yaCounter43856389.reachGoal("ya-manually-sync"),window.location.reload(!0)}).catch(function(t){e(".sync__ava, .menu__ava").attr("data-sync","fail"),e(".sync__hand").removeClass("sync__hand--spin"),console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()})}).catch(function(t){e(".sync__ava, .menu__ava").attr("data-sync","fail"),e(".sync__hand").removeClass("sync__hand--spin"),console.error(t.code+": "+t.message),e(".sync__message").html(t.code+": "+t.message).show()})})}(),function(){if(C){O.find(".js-choose-favicon-counter").parents(".form__group").removeClass("form__group--hidden");var e=JSON.parse(localStorage.getItem("mahoweek")),a=e.settings.faviconCounter;a===!0?O.find(".js-choose-favicon-counter").attr("checked","checked"):O.find(".js-choose-favicon-counter").removeAttr("checked","checked"),O.find(".js-choose-favicon-counter").on("change",function(){a=O.find(".js-choose-favicon-counter").prop("checked"),e=JSON.parse(localStorage.getItem("mahoweek")),e.settings.faviconCounter=a,i(e),t()})}}(),function(){w&&(O.find(".js-choose-notify").parents(".form__group").removeClass("form__group--hidden"),localStorage.getItem("notify")&&"granted"===Notification.permission?O.find('.js-choose-notify option[value="'+localStorage.getItem("notify")+'"]').attr("selected","selected"):localStorage.removeItem("notify"),O.find(".js-choose-notify").on("change",function(){var t=e(this).val(),a="Оповещения включены",s="Теперь добавьте время выполнения делам и держите сайт открытым в браузере, чтобы оповещения приходили.",i="img/notify.png?v=2";if("none"===t)localStorage.setItem("notify","none");else if("granted"===Notification.permission){if(!localStorage.getItem("notify")||"none"===localStorage.getItem("notify")){new Notification(a,{body:s,icon:i,requireInteraction:!0})}localStorage.setItem("notify",t)}else"default"===Notification.permission?Notification.requestPermission(function(e){if("granted"===e){localStorage.setItem("notify",t);new Notification(a,{body:s,icon:i,requireInteraction:!0})}else localStorage.setItem("notify","none"),O.find(".js-choose-notify option").removeAttr("selected","selected")}):"denied"===Notification.permission&&(alert("Ранее вы блокировали отправку вам оповещений. Пожалуйста, разрешите оповещения в настройках сайта в браузере."),O.find(".js-choose-notify option").removeAttr("selected","selected"))}))}(),function(){O.on("submit",function(e){e.preventDefault()});var e=JSON.parse(localStorage.getItem("mahoweek")),t=e.settings.theme,a=e.settings.deleteCompletedTasks;O.find('.js-choose-theme[value="'+t+'"]').attr("checked","checked"),a===!0?O.find(".js-choose-delete-completed-tasks").attr("checked","checked"):O.find(".js-choose-delete-completed-tasks").removeAttr("checked","checked"),O.find(".js-choose-theme, .js-choose-delete-completed-tasks").on("change",function(){t=O.find('.js-choose-theme[name="theme"]:checked').val(),a=O.find(".js-choose-delete-completed-tasks").prop("checked"),I.attr("class","board__theme  board__theme--"+t),e=JSON.parse(localStorage.getItem("mahoweek")),e.settings.theme=t,e.settings.deleteCompletedTasks=a,i(e)})}(),function(){T.on("click",".js-marker-task:not(.grid__date--past):not(.grid__date--completed)",function(){var a=e(this),s=a.parents(".task"),n=s.parents(".list").attr("data-id"),o=s.attr("data-id"),r=a.attr("data-date"),l=JSON.parse(localStorage.getItem("mahoweek")),d=l.tasks.filter(function(e){return e.id==o}),f=l.tasks.indexOf(d[0]);if(l.tasks[f].markers){var u=l.tasks[f].markers.filter(function(e){return e.date==r});if(""!=u){var g=l.tasks[f].markers.indexOf(u[0]);l.tasks[f].markers.splice(g,1),a.removeClass("grid__date--bull")}else l.tasks[f].markers.push({date:r,label:"bull"}),a.addClass("grid__date--bull"),s.hasClass("task--completed")&&(delete l.tasks[f].completed,delete l.tasks[f].completedTime,s.removeClass("task--completed"))}else l.tasks[f].markers=[{date:r,label:"bull"}],a.addClass("grid__date--bull"),s.hasClass("task--completed")&&(delete l.tasks[f].completed,delete l.tasks[f].completedTime,s.removeClass("task--completed"));i(l),m(s),c(n),t()})}(),function(){e(".js-add-list").on("click",function(){var t=a(),s="Краткосрочный план дел №"+(T.find(".list").length+1),n=(new Date).getTime(),r=JSON.parse(localStorage.getItem("mahoweek"));r.lists.push({id:t,name:s,createdTime:n}),i(r),T.append(f(t,s));var l=T.find(".list:last-child");g(document.querySelector(".list:last-child .list__tasks")),l.find(".list__grid").html(o("list")),l.find(".task__grid").html(o("add-task")),l.find(".js-name").trigger("mouseup",["run"]);var d=e(window);l.offset().top>d.scrollTop()+d.height()-30-80&&e("body, html").stop().animate({scrollTop:l.offset().top},S)})}(),function(){T.on("keyup change",".js-edit-list",function(t){var a=e(this);if(13==t.keyCode||"change"==t.type){var s=a.parents(".list"),n=s.attr("data-id"),o=a.val(),r=JSON.parse(localStorage.getItem("mahoweek")),l=r.lists.filter(function(e){return e.id==n}),d=r.lists.indexOf(l[0]);r.lists[d].name=o,i(r),0==s.find(".list__tasks .task").length?s.find(".js-add-task").focus():a.blur()}})}(),function(){T.on("click",".js-remove-list",function(){var a=e(this),s=a.parents(".list"),n=s.attr("data-id"),o=s.find(".list__tasks .task").length;if(o)var r=confirm("При удалении списка, все дела, находящиеся в нём, так же будут удалены.");if(!o||r){var l=JSON.parse(localStorage.getItem("mahoweek")),d=l.lists.filter(function(e){return e.id==n}),c=l.lists.indexOf(d[0]);if(l.lists.splice(c,1),o){for(var f=[],u=0;u<l.tasks.length;u++)l.tasks[u].listId!=n&&f.push(l.tasks[u]);l.tasks=f}i(l),s.remove(),t()}})}(),function(){T.on("focusin",".js-add-task",function(){var t=e(this);t.parents(".list").scrollLeft(0).css({"overflow-x":"hidden","-webkit-overflow-scrolling":"auto"})}),T.on("focusout",".js-add-task",function(){var t=e(this);t.parents(".list").css({"overflow-x":"","-webkit-overflow-scrolling":""})})}(),function(){T.on("keyup change",".js-add-task",function(t){var s=e(this);if(13===t.keyCode&&""!==s.val()||"change"===t.type){var n=s.parents(".list").attr("data-id"),o=a(),r=s.val(),l=(new Date).getTime(),d=JSON.parse(localStorage.getItem("mahoweek"));d.tasks.push({id:o,listId:n,name:r,createdTime:l}),i(d),s.val(""),s.parents(".list").find(".list__tasks").append(_(o,r)),c(n);var f=s.parents(".list").find(".list__tasks .task:last-child"),u=e(window);f.offset().top>u.scrollTop()+u.height()-30-40-39&&u.scrollTop(u.scrollTop()+f.outerHeight(!0)),yaCounter43856389.reachGoal("ya-add-task")}})}(),function(){T.on("click",".js-completed-task",function(){var a=e(this),s=a.parents(".task"),n=s.parents(".list").attr("data-id"),o=s.attr("data-id"),r=s.hasClass("task--completed"),l=s.find(".grid__date--today").attr("data-date"),d=JSON.parse(localStorage.getItem("mahoweek")),f=d.tasks.filter(function(e){return e.id==o}),u=d.tasks.indexOf(f[0]);if(r){s.find(".grid__date--today").removeClass("grid__date--completed");var g="del";delete d.tasks[u].completed,delete d.tasks[u].completedTime,s.removeClass("task--completed")}else{if(s.find(".grid__date--today").toggleClass("grid__date--completed"),s.find(".grid__date--today").hasClass("grid__date--completed"))var g="add";else var g="del";if(!s.find(".grid__date--today").nextAll(".grid__date--bull").length){s.find(".grid__date--today").addClass("grid__date--completed"),g="add";var h=(new Date).getTime();d.tasks[u].completed=1,d.tasks[u].completedTime=h,s.addClass("task--completed")}}if("add"!=g||d.tasks[u].markers){var _=d.tasks[u].markers.filter(function(e){return e.date==l});if(""!=_){var p=d.tasks[u].markers.indexOf(_[0]);"add"==g?d.tasks[u].markers[p].completed=1:d.tasks[u].markers[p].label?delete d.tasks[u].markers[p].completed:d.tasks[u].markers.splice(p,1)}else"add"==g&&d.tasks[u].markers.push({date:l,completed:1})}else d.tasks[u].markers=[{date:l,completed:1}];i(d),m(s),c(n),t()})}(),function(){T.on("keyup change",".js-edit-task",function(t){var a=e(this);if(13==t.keyCode||"change"==t.type){var s=a.parents(".task").attr("data-id"),n=a.val(),o=JSON.parse(localStorage.getItem("mahoweek")),r=o.tasks.filter(function(e){return e.id==s}),l=o.tasks.indexOf(r[0]);o.tasks[l].name=n,i(o),a.blur()}})}(),function(){
T.on("click",".js-remove-task",function(){var a=e(this),s=a.parents(".list").attr("data-id"),n=a.parents(".task").attr("data-id"),o=JSON.parse(localStorage.getItem("mahoweek")),r=o.tasks.filter(function(e){return e.id==n}),l=o.tasks.indexOf(r[0]);o.tasks.splice(l,1),i(o),a.parents(".task").remove(),c(s),t(),yaCounter43856389.reachGoal("ya-remove-task")})}()}(jQuery);