!function(t){"use strict";function e(){var e="/favicon-32x32.png?v=3",a="/img/favicon-today.png?v=2",s=g.find(".task--today").length;t("link[rel$=icon]").remove(),s>0?(t("head").append(t('<link rel="icon" type="image/png" sizes="32x32">').attr("href",a)),Tinycon.setBubble(s)):t("head").append(t('<link rel="icon" type="image/png" sizes="32x32">').attr("href",e))}function a(){for(var t="",e="0123456789abcdefghijklmnopqrstuvwxyz",a=0;a<8;a++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}function s(t){var e=g.find('.list[data-id="'+t+'"] .task:not(.task--add)').length,a=g.find('.list[data-id="'+t+'"] .task--completed').length;if(e>0)var s=100*a/e/100;else var s=0;g.find('.list[data-id="'+t+'"] .list__progress').css({"-webkit-transform":"scaleX("+s+")",transform:"scaleX("+s+")"})}function i(t,e){return'<div class="list" data-id="'+t+'"><div class="list__head"><div class="list__wrap"><div class="list__name  js-name">'+e+'</div><div class="list__options"><div class="list__trash  js-remove-list"><svg><use xlink:href="#icon-trash"></use></svg></div></div><div class="list__progress"></div></div><div class="list__grid  grid"></div></div><div class="list__tasks"><label class="task  task--add"><div class="task__wrap"><div class="task__status"><div class="task__plus"><svg><use xlink:href="#icon-plus"></use></svg></div></div><div class="task__name"><input class="task__input  js-add-task" type="text" maxlength="255"></div></div><div class="task__grid  grid"></div></label></div></div>'}function n(t){t.find(".grid__date.grid__date--past.grid__date--bull:not(.grid__date--completed)").length&&!t.find(".grid__date.grid__date--today.grid__date--completed").length&&t.find(".grid__date.grid__date--past.grid__date--bull:not(.grid__date--completed):last").index()>t.find(".grid__date.grid__date--past.grid__date--completed:last").index()?t.addClass("task--past"):t.removeClass("task--past"),t.find(".grid__date:not(.grid__date--past):not(.grid__date--completed).grid__date--bull").length?t.addClass("task--bull"):t.removeClass("task--bull"),t.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length?t.addClass("task--today"):t.removeClass("task--today")}function o(t){var e=t;return e=/https:\/\/mahoweek\.ru\/#/.test(t)?e.replace(/(https:\/\/)(mahoweek\.ru\/#)([\S]+[^ ,\.!])/gi,'<a href="#$3" class="cartonbox" data-cb-type="inline" data-cb-hash="$3"><span class="hidden">$1</span>$2$3</a>'):e.replace(/(http(s)?:\/\/(www\.)?)([\S]+[^ ,\.!])/gi,'<a href="$1$4" class="js-link-task" target="_blank" rel="noopener noreferrer"><span class="hidden">$1</span>$4</a>'),e=e.replace(/(.+)?(\s)?(\[)((2[0-3]|[0-1]\d):([0-5]\d))(\])(\s)?(.+)?/gi,'<span class="hidden">$3</span><span class="task__time">$4</span><span class="hidden">$7</span> $1$9').trim(),/[!]{3,}/.test(t)&&(e="<strong>"+e.replace(/([!]{3,})/gi,'<span class="hidden">$1</span>')+"</strong>"),e}function r(t,e,a,s){if(1==a)var a=" task--completed";else var a="";return'<div class="task'+a+'" data-id="'+t+'"><div class="task__wrap"><div class="task__status"><div class="task__check  js-completed-task"></div></div><div class="task__name  js-name">'+o(e)+'</div><div class="task__options"><div class="task__trash  js-remove-task"><svg><use xlink:href="#icon-trash"></use></svg></div></div></div><div class="task__grid  grid">'+d("task",s)+"</div></div>"}function d(t,e){var a=new Date,s=a.getDay();0==s&&(s=7);var i=1;if(e)for(var n={},o=0;o<e.length;o++){var r=e[o].date;n[r]=e[o].label+"|"+(e[o].completed?1:0)}for(var d="",o=1-s;o<=14-s;o++){var l="",c=new Date,f=c.setDate(a.getDate()+o),g=c.getDate(f),m=c.getMonth(f)+1,u=c.getFullYear(f),k=c.getDay(),p=u+"-"+(m<10?"0"+m:m)+"-"+(g<10?"0"+g:g);0==k&&(k=7),a.getDate()==g&&(l+=" grid__date--today",i=0),i&&(l+=" grid__date--past"),6!=k&&7!=k||(l+=" grid__date--holiday"),"task"==t&&(l+=" js-marker-task",n&&p in n&&("bull"==n[p].split("|")[0]&&(l+=" grid__date--bull"),1==n[p].split("|")[1]&&(l+=" grid__date--completed"))),d+='<div class="grid__date'+l+'" data-date="'+p+'">',"list"==t&&(d+=g),d+="</div>"}return d}if(setTimeout(function(){t("body").scrollTop(0)},1),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){t("body").addClass("mobile");var l=1}var c=t(".board"),f=c.find(".board__theme"),g=c.find(".board__lists"),m=t(".form--settings"),u=t(".form--storage");!function(){var e=1e3,a=new Date;setTimeout(function s(){var i=new Date,n=i.getTime();a.getDay()!=i.getDay()&&(window.location.reload(!0),a=i);var o=localStorage.getItem("notify");if(o&&"none"!=o&&"granted"===Notification.permission){var o=1*o,r=i.getHours(),d=i.getMinutes(),l=(r<10?"0"+r:r)+":"+(d<10?"0"+d:d);if(9e5==o)var c="15 минут",f=12e4;else if(18e5==o)var c="30 минут",f=3e5;else if(36e5==o)var c="1 час",f=6e5;else if(72e5==o)var c="2 часа",f=9e5;g.find(".task__time").each(function(){var e=t(this),a=e.parents(".task"),s=e.text(),i=a.find(".task__name").text();if(i=i.replace(/(\[)((2[0-3]|[0-1]\d):([0-5]\d))(\]) /gi,""),i=i.replace(/[!]{3,}/gi,""),a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length&&s>l)var r=a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").attr("data-date"),d=r+"T"+s+":00";else if(a.find(".grid__date--today + .grid__date--bull").length)var r=a.find(".grid__date--today + .grid__date--bull").attr("data-date"),d=r+"T"+s+":00";if(d&&(!a.attr("data-notify")||a.attr("data-notify")&&a.attr("data-notify")!=d)&&n+o>=Date.parse(d)&&n+o<=Date.parse(d)+f){new Notification("Через "+c+" в "+s,{body:i,icon:"/img/notify.png"});a.attr("data-notify",d)}})}setTimeout(s,e)},e)}(),function(){if(localStorage.getItem("mahoweek")){var e=JSON.parse(localStorage.getItem("mahoweek"));f.addClass("board__theme--"+e.settings.theme);for(var s=0;s<e.tasks.length;s++)if(e.tasks[s].markers)for(var i=0;i<e.tasks[s].markers.length;i++)/([\d]{2}).([\d]{2}).([\d]{4})/gi.test(e.tasks[s].markers[i].date)&&(e.tasks[s].markers[i].date=e.tasks[s].markers[i].date.replace(/([\d]{2}).([\d]{2}).([\d]{4})/gi,"$3-$2-$1"));localStorage.setItem("mahoweek",JSON.stringify(e))}else{var n=a(),o="leaves",r={lists:[{id:n,name:"Краткосрочный план дел",createdTime:(new Date).getTime()}],tasks:[{id:a(),listId:n,name:"Прочитать справку о сайте: https://mahoweek.ru/#about",createdTime:(new Date).getTime()},{id:a(),listId:n,name:"Посмотреть как здесь всё устроено: https://mahoweek.ru/#tour",createdTime:(new Date).getTime()},{id:a(),listId:n,name:"Настроить доску: https://mahoweek.ru/#settings",createdTime:(new Date).getTime()},{id:a(),listId:n,name:"Добавить ещё дел в список",createdTime:(new Date).getTime()},{id:a(),listId:n,name:"Наметить на календарной сетке даты выполнения задач",createdTime:(new Date).getTime()}],settings:{theme:o}};localStorage.setItem("mahoweek",JSON.stringify(r)),f.addClass("board__theme--"+o),t("body").attr("data-visit","first")}}(),function(){var e=0,a=0,s=l?"touchstart":"mousedown";g.on(s,".js-name",function(t){if("touchstart"==t.type){var a=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];e=a.pageX+a.pageY}else e=t.pageX+t.pageY;g.find(".js-add-task").blur()});var i=l?"touchend":"mouseup";g.on(i,".js-name",function(s){var i=t(this);if("touchend"==s.type){var n=s.originalEvent.touches[0]||s.originalEvent.changedTouches[0];a=n.pageX+n.pageY}else a=s.pageX+s.pageY;if("mouseup"==s.type&&1!=s.which)return!1;if(!t(s.target).hasClass("js-link-task")&&!t(s.target).hasClass("cartonbox")&&e==a){if(i.hasClass("list__name")&&!i.parents(".list").find(".list__input").length){var r=i.text();i.html('<input class="list__input  js-edit-list" type="text" maxlength="255" value="">'),i.parents(".list").find(".list__input").val(r).select(),i.parents(".list").find(".list__input").focusout(function(){i.text(t(this).val())})}if(i.hasClass("task__name")&&!i.parents(".task").find(".task__input").length){var d=i.text();i.html('<input class="task__input  js-edit-task" type="text" maxlength="255" value="">'),i.parents(".task").find(".task__input").val(d).focus(),i.parents(".task").find(".task__input").focusout(function(){i.html(o(t(this).val()))})}}})}(),function(){var e={speed:1,preload:!1,closeHtml:'<svg><use xlink:href="#icon-close"></use></svg>',onStartBefore:function(){t(".cartonbox-close").prependTo(".cartonbox-container")},onShowBefore:function(){if("#storage"==window.location.hash){var t=JSON.parse(localStorage.getItem("mahoweek")),t=JSON.stringify(t,"",2);u.find(".js-edit-storage").val(t)}}};t.cartonbox(e),"first"==t("body").attr("data-visit")&&t(".js-open-welcome").trigger("click"),t(".js-close-welcome").on("click",function(){t(".cartonbox-close").trigger("click"),c.addClass("board--load")})}(),function(){var t={},e=null,a=null,s=null,i=null,n={},o=Math.ceil(window.devicePixelRatio)||1,r=16*o,d={width:16,height:16,font:11*o+"px Courier New",color:"#000",background:"transparent",fallback:!0,crossOrigin:!0,abbreviate:!0},l=function(){var t=navigator.userAgent.toLowerCase();return function(e){return t.indexOf(e)!==-1}}(),c={ie:l("trident"),chrome:l("chrome"),webkit:l("chrome")||l("safari"),safari:l("safari")&&!l("chrome"),mozilla:l("mozilla")&&!l("chrome")&&!l("safari")},f=function(){for(var t=document.getElementsByTagName("link"),e=0,a=t.length;e<a;e++)if((t[e].getAttribute("rel")||"").match(/\bicon\b/i))return t[e];return!1},g=function(){for(var t=document.getElementsByTagName("link"),e=0,a=t.length;e<a;e++){var s="undefined"!=typeof t[e];s&&(t[e].getAttribute("rel")||"").match(/\bicon\b/i)&&t[e].parentNode.removeChild(t[e])}},m=function(){if(!a||!e){var t=f();e=t?t.getAttribute("href"):"/favicon.ico",a||(a=e)}return e},u=function(){return i||(i=document.createElement("canvas"),i.width=r,i.height=r),i},k=function(t){if(t){g();var e=document.createElement("link");e.type="image/x-icon",e.rel="icon",e.href=t,document.getElementsByTagName("head")[0].appendChild(e)}},p=function(t,e){if(!u().getContext||c.ie||c.safari||"force"===n.fallback)return h(t);var a=u().getContext("2d"),e=e||"#000000",i=m();s=document.createElement("img"),s.onload=function(){a.clearRect(0,0,r,r),a.drawImage(s,2,2,s.width,s.height,0,0,r,r),(t+"").length>0&&_(a,t,e),v()},!i.match(/^data/)&&n.crossOrigin&&(s.crossOrigin="anonymous"),s.src=i},h=function(t){if(n.fallback){var e=document.title;"("===e[0]&&(e=e.slice(e.indexOf(" "))),(t+"").length>0?document.title="("+t+") "+e:document.title=e}},_=function(t,e,a){"number"==typeof e&&e>99&&n.abbreviate&&(e=w(e));var s=(e+"").length-1,i=n.width*o+6*o*s,d=n.height*o,l=r-d,f=r-i-o,g=16*o,m=16*o,u=2*o;t.font=(c.webkit?"bold ":"")+n.font,t.fillStyle=n.background,t.strokeStyle=n.background,t.lineWidth=o,t.beginPath(),t.moveTo(f+u,l),t.quadraticCurveTo(f,l,f,l+u),t.lineTo(f,g-u),t.quadraticCurveTo(f,g,f+u,g),t.lineTo(m-u,g),t.quadraticCurveTo(m,g,m,g-u),t.lineTo(m,l+u),t.quadraticCurveTo(m,l,m-u,l),t.closePath(),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.9)",t.lineWidth=2,t.textAlign="right",t.textBaseline="top",t.strokeText(e,2===o?32:16,c.mozilla?7*o:6*o),t.fillStyle=n.color,t.textAlign="right",t.textBaseline="top",t.fillText(e,2===o?32:16,c.mozilla?7*o:6*o)},v=function(){u().getContext&&k(u().toDataURL())},w=function(t){for(var e=[["G",1e9],["M",1e6],["k",1e3]],a=0;a<e.length;++a)if(t>=e[a][1]){t=b(t/e[a][1])+e[a][0];break}return t},b=function(t,e){var a=new Number(t);return a.toFixed(e)};t.setOptions=function(t){n={},t.colour&&(t.color=t.colour);for(var e in d)n[e]=t.hasOwnProperty(e)?t[e]:d[e];return this},t.setImage=function(t){return e=t,v(),this},t.setBubble=function(t,e){return t=t||"",p(t,e),this},t.reset=function(){e=a,k(a)},t.setOptions(d),"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module?module.exports=t:window.Tinycon=t}(),function(){for(var t=JSON.parse(localStorage.getItem("mahoweek")),e="",a=0;a<t.lists.length;a++)e+=i(t.lists[a].id,t.lists[a].name);g.prepend(e)}(),g.find(".list__grid").html(d("list")),g.find(".task__grid").html(d()),function(){t(".js-add-list").on("click",function(){var e=a(),s="Краткосрочный план дел №"+(g.find(".list").length+1),n=(new Date).getTime(),o=JSON.parse(localStorage.getItem("mahoweek"));o.lists.push({id:e,name:s,createdTime:n}),localStorage.setItem("mahoweek",JSON.stringify(o)),g.append(i(e,s));var r=g.find(".list:last-child");r.find(".list__grid").html(d("list")),r.find(".task__grid").html(d()),r.find(".js-add-task").focus();var l=t(window);r.offset().top>l.scrollTop()+l.height()-30-80&&t("body").scrollTop(r.offset().top)})}(),function(){g.on("keyup change",".js-edit-list",function(e){var a=t(this),s=a.parents(".list").attr("data-id"),i=a.val(),n=JSON.parse(localStorage.getItem("mahoweek")),o=n.lists.filter(function(t){return t.id==s}),r=n.lists.indexOf(o[0]);n.lists[r].name=i,localStorage.setItem("mahoweek",JSON.stringify(n)),13==e.keyCode&&a.blur()})}(),function(){g.on("click",".js-remove-list",function(){var a=t(this),s=a.parents(".list").attr("data-id"),i=a.parents(".list").find(".task:not(.task--add)").length;if(i)var n=confirm("При удалении списка, все дела, находящиеся в нём, так же будут удалены.");if(!i||n){var o=JSON.parse(localStorage.getItem("mahoweek")),r=o.lists.filter(function(t){return t.id==s}),d=o.lists.indexOf(r[0]);if(o.lists.splice(d,1),i){for(var l=[],c=0;c<o.tasks.length;c++)o.tasks[c].listId!=s&&l.push(o.tasks[c]);o.tasks=l}localStorage.setItem("mahoweek",JSON.stringify(o)),a.parents(".list").remove(),e()}})}(),function(){var t=l?200:0;Sortable.create(document.querySelector(".board__lists"),{delay:t,animation:0,handle:".list__name",filter:".list__input",preventOnFilter:!1,ghostClass:"list--ghost",chosenClass:"list--chosen",dragClass:"list--drag",scrollSensitivity:80,onClone:function(){g.addClass("board__lists--drag")},onEnd:function(t){if(Number.isInteger(t.oldIndex)&&Number.isInteger(t.newIndex)&&t.oldIndex>=0&&t.newIndex>=0&&t.oldIndex!=t.newIndex){var e=JSON.parse(localStorage.getItem("mahoweek"));if(void 0!==e.lists[t.oldIndex]&&void 0!==e.lists[t.newIndex]){var a=e.lists.splice(t.oldIndex,1)[0];e.lists.splice(t.newIndex,0,a),localStorage.setItem("mahoweek",JSON.stringify(e))}else window.location.reload(!0)}g.removeClass("board__lists--drag")}})}(),function(){for(var t=JSON.parse(localStorage.getItem("mahoweek")),a=0;a<t.tasks.length;a++){g.find('.list[data-id="'+t.tasks[a].listId+'"] .task--add').before(r(t.tasks[a].id,t.tasks[a].name,t.tasks[a].completed,t.tasks[a].markers));var i=g.find('.task[data-id="'+t.tasks[a].id+'"]');n(i)}for(var a=0;a<t.lists.length;a++)s(t.lists[a].id);"#welcome"!=window.location.hash&&c.addClass("board--load"),e()}(),function(){g.find(".js-add-task").focusin(function(){var e=t(this);e.parents(".task--add").addClass("task--focus")}),g.find(".js-add-task").focusout(function(){var e=t(this);e.parents(".task--add").removeClass("task--focus")})}(),function(){g.on("change",".js-add-task",function(){var e=t(this),i=e.parents(".list").attr("data-id"),n=a(),o=e.val(),d=(new Date).getTime(),l=JSON.parse(localStorage.getItem("mahoweek"));l.tasks.push({id:n,listId:i,name:o,createdTime:d}),localStorage.setItem("mahoweek",JSON.stringify(l)),e.val(""),e.parents(".task--add").before(r(n,o)),s(i);var c=e.parents(".task--add").prev(),f=t(window);c.offset().top>f.scrollTop()+f.height()-30-40-39&&t("body").scrollTop(f.scrollTop()+c.outerHeight(!0))})}(),function(){g.on("click",".js-completed-task",function(){var a=t(this),i=a.parents(".task"),o=i.parents(".list").attr("data-id"),r=i.attr("data-id"),d=i.hasClass("task--completed"),l=i.find(".grid__date--today").attr("data-date"),c=JSON.parse(localStorage.getItem("mahoweek")),f=c.tasks.filter(function(t){return t.id==r}),g=c.tasks.indexOf(f[0]);if(d){i.find(".grid__date--today").removeClass("grid__date--completed");var m="del";delete c.tasks[g].completed,delete c.tasks[g].completedTime,i.removeClass("task--completed")}else{if(i.find(".grid__date--today").toggleClass("grid__date--completed"),i.find(".grid__date--today").hasClass("grid__date--completed"))var m="add";else var m="del";if(!i.find(".grid__date--today").nextAll(".grid__date--bull").length){i.find(".grid__date--today").addClass("grid__date--completed"),m="add";var u=(new Date).getTime();c.tasks[g].completed=1,c.tasks[g].completedTime=u,i.addClass("task--completed")}}if("add"!=m||c.tasks[g].markers){var k=c.tasks[g].markers.filter(function(t){return t.date==l});if(""!=k){var p=c.tasks[g].markers.indexOf(k[0]);"add"==m?c.tasks[g].markers[p].completed=1:c.tasks[g].markers[p].label?delete c.tasks[g].markers[p].completed:c.tasks[g].markers.splice(p,1)}else"add"==m&&c.tasks[g].markers.push({date:l,completed:1})}else c.tasks[g].markers=[{date:l,completed:1}];localStorage.setItem("mahoweek",JSON.stringify(c)),n(i),s(o),e()})}(),function(){g.on("keyup change",".js-edit-task",function(e){var a=t(this),s=a.parents(".task").attr("data-id"),i=a.val(),n=JSON.parse(localStorage.getItem("mahoweek")),o=n.tasks.filter(function(t){return t.id==s}),r=n.tasks.indexOf(o[0]);n.tasks[r].name=i,localStorage.setItem("mahoweek",JSON.stringify(n)),13==e.keyCode&&a.blur()})}(),function(){g.on("click",".js-remove-task",function(){var a=t(this),i=a.parents(".list").attr("data-id"),n=a.parents(".task").attr("data-id"),o=JSON.parse(localStorage.getItem("mahoweek")),r=o.tasks.filter(function(t){return t.id==n}),d=o.tasks.indexOf(r[0]);o.tasks.splice(d,1),localStorage.setItem("mahoweek",JSON.stringify(o)),a.parents(".task").remove(),s(i),e()})}(),function(){g.on("click",".js-marker-task:not(.grid__date--past):not(.grid__date--completed)",function(){var a=t(this),i=a.parents(".task"),o=i.parents(".list").attr("data-id"),r=i.attr("data-id"),d=a.attr("data-date"),l=JSON.parse(localStorage.getItem("mahoweek")),c=l.tasks.filter(function(t){return t.id==r}),f=l.tasks.indexOf(c[0]);if(l.tasks[f].markers){var g=l.tasks[f].markers.filter(function(t){return t.date==d});if(""!=g){var m=l.tasks[f].markers.indexOf(g[0]);l.tasks[f].markers.splice(m,1),a.removeClass("grid__date--bull")}else l.tasks[f].markers.push({date:d,label:"bull"}),a.addClass("grid__date--bull"),i.hasClass("task--completed")&&(delete l.tasks[f].completed,delete l.tasks[f].completedTime,i.removeClass("task--completed"))}else l.tasks[f].markers=[{date:d,label:"bull"}],a.addClass("grid__date--bull"),i.hasClass("task--completed")&&(delete l.tasks[f].completed,delete l.tasks[f].completedTime,i.removeClass("task--completed"));localStorage.setItem("mahoweek",JSON.stringify(l)),n(i),s(o),e()})}(),function(){"Notification"in window&&(m.find(".js-choose-notify").parents(".form__group").removeClass("form__group--hidden"),localStorage.getItem("notify")&&"none"!=localStorage.getItem("notify")&&"granted"===Notification.permission&&m.find('.js-choose-notify option[value="'+localStorage.getItem("notify")+'"]').attr("selected","selected"),m.find(".js-choose-notify").on("change",function(){var e=t(this).val();"none"==e?localStorage.setItem("notify","none"):"granted"===Notification.permission?localStorage.setItem("notify",e):"default"===Notification.permission?Notification.requestPermission(function(t){if("granted"===t){localStorage.setItem("notify",e);new Notification("Оповещения включены",{body:"Держите сайт открытым в браузере, чтобы оповещения приходили.",icon:"/img/notify.png"})}else localStorage.setItem("notify","none"),m.find(".js-choose-notify option").removeAttr("selected","selected")}):"denied"===Notification.permission&&(alert("Ранее вы блокировали отправку вам оповещений. Пожалуйста, разрешите оповещения в настройках сайта в браузере."),m.find(".js-choose-notify option").removeAttr("selected","selected"))}))}(),function(){m.on("submit",function(t){t.preventDefault()});var t=JSON.parse(localStorage.getItem("mahoweek")),e=t.settings.theme;m.find('.js-choose-theme[value="'+e+'"]').attr("checked","checked"),m.find(":checkbox, :radio").on("change",function(){var t=JSON.parse(localStorage.getItem("mahoweek"));e=m.find('.js-choose-theme[name="theme"]:checked').val(),f.attr("class","board__theme  board__theme--"+e),t.settings.theme=e,localStorage.setItem("mahoweek",JSON.stringify(t))})}(),function(){u.on("submit",function(t){t.preventDefault();var e=JSON.parse(u.find(".js-edit-storage").val());localStorage.setItem("mahoweek",JSON.stringify(e)),window.location.replace("/")})}()}(jQuery);