!function(t){"use strict";function a(t,a){var e=new Date,s=e.getDay();0==s&&(s=7);var i=1;if(a)for(var n={},o=0;o<a.length;o++){var d=a[o].day;n[d]=a[o].label}for(var r="",o=1-s;o<=14-s;o++){var l="",k=new Date,c=k.setDate(e.getDate()+o),f=k.getDate(c),g=k.getMonth(c)+1,u=k.getFullYear(c),h=k.getDay(),m=(f<10?"0"+f:f)+"."+(g<10?"0"+g:g)+"."+u;0==h&&(h=7),e.getDate()==f&&(l+=" grid__date--today",i=0),i&&(l+=" grid__date--past"),6!=h&&7!=h||(l+=" grid__date--holiday"),"task"==t&&(l+=" js-marker-task"),r+='<div class="grid__date'+l+'" data-day="'+m+'">',"list"==t&&(r+=f),"task"==t&&n&&m in n&&(r+='<svg class="grid__bull"><use xlink:href="#ei-bull-icon"></use></svg>'),r+="</div>"}return r}function e(){var a=t(".task:not(.task--add)").length,e=t('.task:not(.task--add)[data-completed="1"]').length;if(a>0)var s=100*e/a/100;else var s=0;o.find(".list__progress").css({"-webkit-transform":"scaleX("+s+")",transform:"scaleX("+s+")"})}function s(){for(var t="",a="0123456789abcdefghijklmnopqrstuvwxyz",e=0;e<8;e++)t+=a.charAt(Math.floor(Math.random()*a.length));return t}function i(t,e,s,i){if(1==s)var s=' data-completed="1"';else var s="";return'<div class="task" data-id="'+t+'"'+s+'><div class="task__status"><div class="task__check  js-completed-task"></div></div><div class="task__name">'+e+'</div><div class="task__options"><div class="task__trash  js-remove-task"><svg><use xlink:href="#ei-trash-icon"></use></svg></div></div><div class="task__grid  grid">'+a("task",i)+"</div></div>"}if(!localStorage.getItem("mahoweek")){var n={tasks:[],settings:{}};localStorage.setItem("mahoweek",JSON.stringify(n))}/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&t("body").addClass("mobile");var o=t(".list");o.find(".list__grid").html(a("list")),function(){if(!t("body").hasClass("mobile")){var a=t(window),e=a.scrollTop(),s=o.offset().top;a.on("scroll",function(){var a=t(this);e=a.scrollTop(),e>=s?o.find(".list__head").addClass("list__head--fixed"):o.find(".list__head").removeClass("list__head--fixed")})}}();var d=t(".list__tasks");!function(){for(var t=JSON.parse(localStorage.getItem("mahoweek")),a="",s=0;s<t.tasks.length;s++)a+=i(t.tasks[s].id,t.tasks[s].name,t.tasks[s].completed,t.tasks[s].markers);d.prepend(a),e()}(),d.find(".task--add .task__grid").html(a()),function(){if(!t("body").hasClass("mobile")){var a=t(window),e=a.height(),s=a.scrollTop(),i=d.offset().top,n=d.height()-1,o=d.find(".task--add").innerHeight();s+e-o<=i+n&&d.find(".task--add").addClass("task--fixed"),a.on("scroll resize",function(){var a=t(this);s=a.scrollTop(),e=a.height(),i=d.offset().top,n=d.height()-1,s+e-o<=i+n?d.find(".task--add").addClass("task--fixed"):d.find(".task--add").removeClass("task--fixed")})}}(),function(){t("body").hasClass("mobile")||d.find(".js-add-task").focus(),d.find(".js-add-task").focusin(function(){var a=t(this);a.parents(".task--add").addClass("task--focus")}),d.find(".js-add-task").focusout(function(){var a=t(this);a.parents(".task--add").removeClass("task--focus")})}(),function(){t(".js-add-task").on("change",function(){var a=t(this),n=a.val(),o=(new Date).getTime(),r=s(),l=JSON.parse(localStorage.getItem("mahoweek"));l.tasks.push({id:r,name:n,createdTime:o}),localStorage.setItem("mahoweek",JSON.stringify(l)),a.val(""),d.find(".task--add").before(i(r,n)),e(),t("body").hasClass("mobile")||t("body").scrollTop(1e4)})}(),function(){d.on("click",".js-completed-task",function(){var a=t(this),s=a.parents(".task").attr("data-id"),i=a.parents(".task").attr("data-completed"),n=JSON.parse(localStorage.getItem("mahoweek")),o=n.tasks.filter(function(t){return t.id==s}),d=n.tasks.indexOf(o[0]);if(i)delete n.tasks[d].completed,delete n.tasks[d].completedTime,a.parents(".task").removeAttr("data-completed");else{var r=(new Date).getTime();n.tasks[d].completed=1,n.tasks[d].completedTime=r,a.parents(".task").attr("data-completed",1)}localStorage.setItem("mahoweek",JSON.stringify(n)),e()})}(),function(){var a=0,e=0,s=t("body").hasClass("mobile")?"touchstart":"mousedown";d.on(s,".task:not(.task--add) .task__name",function(t){if("touchstart"==t.type){var e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];a=e.pageX+e.pageY}else a=t.pageX+t.pageY;d.find(".js-add-task").blur()});var i=t("body").hasClass("mobile")?"touchend":"mouseup";d.on(i,".task:not(.task--add) .task__name",function(s){var i=t(this);if("touchend"==s.type){var n=s.originalEvent.touches[0]||s.originalEvent.changedTouches[0];e=n.pageX+n.pageY}else e=s.pageX+s.pageY;if("mouseup"==s.type&&1!=s.which)return!1;if(a==e&&!i.parents(".task").find(".task__input").length){var o=i.text();i.html('<input class="task__input  js-edit-task" type="text" maxlength="100" value="">'),i.parents(".task").find(".task__input").focus().val(o),i.parents(".task").find(".task__input").focusout(function(){i.text(t(this).val())})}})}(),function(){d.on("keyup change",".js-edit-task",function(a){var e=t(this),s=e.parents(".task").attr("data-id"),i=e.val(),n=JSON.parse(localStorage.getItem("mahoweek")),o=n.tasks.filter(function(t){return t.id==s}),d=n.tasks.indexOf(o[0]),r=(new Date).getTime();n.tasks[d].name=i,n.tasks[d].lastChange=r,localStorage.setItem("mahoweek",JSON.stringify(n)),13==a.keyCode&&e.blur()})}(),function(){d.on("click",".js-remove-task",function(){var a=t(this),s=a.parents(".task").attr("data-id"),i=JSON.parse(localStorage.getItem("mahoweek")),n=i.tasks.filter(function(t){return t.id==s}),o=i.tasks.indexOf(n[0]);if(i.tasks.splice(o,1),localStorage.setItem("mahoweek",JSON.stringify(i)),a.parents(".task").remove(),0==d.find(".task:not(.task--add)").length&&d.find(".js-add-task").focus(),e(),!t("body").hasClass("mobile")&&d.find(".task--add").hasClass("task--fixed")){var r=t(window),l=r.height(),k=r.scrollTop(),c=d.offset().top,f=d.height()-1,g=d.find(".task--add").innerHeight();k+l-g>c+f&&d.find(".task--add").removeClass("task--fixed")}})}(),function(){d.on("click",'.task:not([data-completed="1"]) .js-marker-task:not(.grid__date--past)',function(){var a=t(this),e=a.parents(".task").attr("data-id"),s=a.attr("data-day"),i=JSON.parse(localStorage.getItem("mahoweek")),n=i.tasks.filter(function(t){return t.id==e}),o=i.tasks.indexOf(n[0]);if(i.tasks[o].markers){var d=i.tasks[o].markers.filter(function(t){return t.day==s});if(""!=d){var r=i.tasks[o].markers.indexOf(d[0]);i.tasks[o].markers.splice(r,1),a.html("")}else i.tasks[o].markers.push({day:s,label:"bull"}),a.html('<svg class="grid__bull"><use xlink:href="#ei-bull-icon"></use></svg>')}else i.tasks[o].markers=[{day:s,label:"bull"}],a.html('<svg class="grid__bull"><use xlink:href="#ei-bull-icon"></use></svg>');var l=(new Date).getTime();i.tasks[o].lastChange=l,localStorage.setItem("mahoweek",JSON.stringify(i))})}(),function(){Sortable.create(document.querySelector(".list__tasks"),{delay:200,animation:0,filter:".task--add, .task__input",preventOnFilter:!1,ghostClass:"task--ghost",chosenClass:"task--chosen",dragClass:"task--drag",scrollSensitivity:80,onChoose:function(){d.addClass("list__tasks--drag")},onEnd:function(t){if(Number.isInteger(t.oldIndex)&&Number.isInteger(t.newIndex)&&t.oldIndex!=t.newIndex){var a=JSON.parse(localStorage.getItem("mahoweek")),e=a.tasks.splice(t.oldIndex,1)[0];void 0!==e?(a.tasks.splice(t.newIndex,0,e),localStorage.setItem("mahoweek",JSON.stringify(a)),d.removeClass("list__tasks--drag")):location.reload()}}})}()}(jQuery);