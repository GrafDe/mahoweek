!function(t){"use strict";function a(){var a=t(".task:not(.task--add)").length,s=t('.task:not(.task--add)[data-completed="1"]').length;if(a>0)var e=100*s/a/100;else var e=0;o.find(".list__progress").css({"-webkit-transform":"scaleX("+e+")",transform:"scaleX("+e+")"})}function s(){for(var t="",a="0123456789abcdefghijklmnopqrstuvwxyz",s=0;s<8;s++)t+=a.charAt(Math.floor(Math.random()*a.length));return t}function e(t,a,s){if(1==s)var s=' data-completed="1"';else var s="";return'<div class="task" data-id="'+t+'"'+s+'><div class="task__status"><div class="task__check  js-completed-task"></div></div><div class="task__name"><input class="task__input  js-edit-task" type="text" value="'+a+'"></div><div class="task__options"><div class="task__trash  js-remove-task"><svg><use xlink:href="#ei-trash-icon"></use></svg></div></div></div>'}if(!localStorage.getItem("mahoweek")){var i={tasks:[],settings:{}};localStorage.setItem("mahoweek",JSON.stringify(i))}/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&t("body").addClass("mobile");var o=t(".list");!function(){if(!t("body").hasClass("mobile")){var a=t(window),s=a.scrollTop(),e=o.offset().top;a.on("scroll",function(){var a=t(this);s=a.scrollTop(),s>=e?o.find(".list__head").addClass("list__head--fixed"):o.find(".list__head").removeClass("list__head--fixed")})}}();var d=t(".list__tasks");!function(){for(var t=JSON.parse(localStorage.getItem("mahoweek")),s="",i=0;i<t.tasks.length;i++)s+=e(t.tasks[i].id,t.tasks[i].name,t.tasks[i].completed);d.prepend(s),a()}(),function(){if(!t("body").hasClass("mobile")){var a=t(window),s=a.height(),e=a.scrollTop(),i=d.offset().top,o=d.height()-1,n=d.find(".task--add").innerHeight();e+s-n<=i+o&&d.find(".task--add").addClass("task--fixed"),a.on("scroll resize",function(){var a=t(this);e=a.scrollTop(),s=a.height(),i=d.offset().top,o=d.height()-1,e+s-n<=i+o?d.find(".task--add").addClass("task--fixed"):d.find(".task--add").removeClass("task--fixed")})}}(),function(){t("body").hasClass("mobile")||d.find(".js-add-task").focus(),d.find(".js-add-task").focusin(function(){var a=t(this);a.parents(".task--add").addClass("task--focus")}),d.find(".js-add-task").focusout(function(){t(this);t(this).parents(".task--add").removeClass("task--focus")})}(),function(){d.on("click",".js-completed-task",function(){var s=t(this),e=s.parents(".task").attr("data-id"),i=s.parents(".task").attr("data-completed"),o=JSON.parse(localStorage.getItem("mahoweek")),d=o.tasks.filter(function(t){return t.id==e}),n=o.tasks.indexOf(d[0]);if(i)delete o.tasks[n].completed,delete o.tasks[n].completedTime,s.parents(".task").removeAttr("data-completed");else{var l=(new Date).getTime();o.tasks[n].completed=1,o.tasks[n].completedTime=l,s.parents(".task").attr("data-completed",1)}localStorage.setItem("mahoweek",JSON.stringify(o)),a()})}(),function(){d.on("click",".js-remove-task",function(){var s=t(this),e=s.parents(".task").attr("data-id"),i=JSON.parse(localStorage.getItem("mahoweek")),o=i.tasks.filter(function(t){return t.id==e}),n=i.tasks.indexOf(o[0]);if(i.tasks.splice(n,1),localStorage.setItem("mahoweek",JSON.stringify(i)),s.parents(".task").remove(),0==d.find(".task:not(.task--add)").length&&d.find(".js-add-task").focus(),a(),!t("body").hasClass("mobile")&&d.find(".task--add").hasClass("task--fixed")){var l=t(window),r=l.height(),k=l.scrollTop(),c=d.offset().top,f=d.height()-1,m=d.find(".task--add").innerHeight();k+r-m>c+f&&d.find(".task--add").removeClass("task--fixed")}})}(),function(){d.on("keyup change",".js-edit-task",function(a){var s=t(this),e=s.parents(".task").attr("data-id"),i=s.val(),o=JSON.parse(localStorage.getItem("mahoweek")),d=o.tasks.filter(function(t){return t.id==e}),n=o.tasks.indexOf(d[0]),l=(new Date).getTime();o.tasks[n].name=i,o.tasks[n].lastChange=l,localStorage.setItem("mahoweek",JSON.stringify(o)),13==a.keyCode&&s.blur()})}(),function(){t(".js-add-task").on("change",function(){var i=t(this),o=i.val(),n=(new Date).getTime(),l=s(),r=JSON.parse(localStorage.getItem("mahoweek"));r.tasks.push({id:l,name:o,createdTime:n}),localStorage.setItem("mahoweek",JSON.stringify(r)),i.val(""),d.find(".task--add").before(e(l,o)),a(),t("body").hasClass("mobile")||t("body").scrollTop(1e6)})}(),function(){Sortable.create(document.querySelector(".list__tasks"),{delay:500,handle:".task__name",animation:0,filter:".task--add .task__name",ghostClass:"task--ghost",chosenClass:"task--chosen",dragClass:"task--drag",scrollSensitivity:80,onEnd:function(t){var a=JSON.parse(localStorage.getItem("mahoweek"));a.tasks.splice(t.newIndex,0,a.tasks.splice(t.oldIndex,1)[0]),localStorage.setItem("mahoweek",JSON.stringify(a))}})}()}(jQuery);