!function(t){"use strict";function s(){var s=t(".task:not(.task--add)").length,a=t('.task:not(.task--add)[data-completed="1"]').length;if(s>0)var e=100*a/s/100;else var e=0;d.find(".list__progress").css({"-webkit-transform":"scaleX("+e+")",transform:"scaleX("+e+")"})}function a(){for(var t="",s="0123456789abcdefghijklmnopqrstuvwxyz",a=0;a<8;a++)t+=s.charAt(Math.floor(Math.random()*s.length));return t}function e(t,s,a){if(1==a)var a=' data-completed="1"';else var a="";return'<div class="task" data-id="'+t+'"'+a+'><div class="task__status"><div class="task__check  js-completed-task"><svg><use xlink:href="#ei-check-icon"></use></svg></div></div><div class="task__name"><input class="task__input  js-edit-task" type="text" value="'+s+'"></div><div class="task__options"><div class="task__trash  js-remove-task"><svg><use xlink:href="#ei-trash-icon"></use></svg></div></div></div>'}if(!localStorage.getItem("dosho")){var o={tasks:[],settings:{}};localStorage.setItem("dosho",JSON.stringify(o))}/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&t("body").addClass("mobile");var d=t(".list");!function(){if(!t("body").hasClass("mobile")){var s=t(window),a=s.scrollTop(),e=d.offset().top;s.on("scroll",function(){a=s.scrollTop(),a>=e?d.find(".list__head").addClass("list__head--fixed"):d.find(".list__head").removeClass("list__head--fixed")})}}();var i=t(".list__tasks");!function(){for(var t=JSON.parse(localStorage.getItem("dosho")),a="",o=0;o<t.tasks.length;o++)a+=e(t.tasks[o].id,t.tasks[o].name,t.tasks[o].completed);i.prepend(a),s()}(),function(){i.on("click",".js-completed-task",function(){var a=t(this),e=a.parents(".task").attr("data-id"),o=a.parents(".task").attr("data-completed"),d=JSON.parse(localStorage.getItem("dosho")),i=d.tasks.filter(function(t){return t.id==e}),n=d.tasks.indexOf(i[0]);if(o)delete d.tasks[n].completed,delete d.tasks[n].completedTime,a.parents(".task").removeAttr("data-completed");else{var l=new Date,r=l.getTime();d.tasks[n].completed=1,d.tasks[n].completedTime=r,a.parents(".task").attr("data-completed",1)}localStorage.setItem("dosho",JSON.stringify(d)),s()})}(),function(){i.on("click",".js-remove-task",function(){var a=t(this),e=a.parents(".task").attr("data-id"),o=JSON.parse(localStorage.getItem("dosho")),d=o.tasks.filter(function(t){return t.id==e}),n=o.tasks.indexOf(d[0]);if(o.tasks.splice(n,1),localStorage.setItem("dosho",JSON.stringify(o)),a.parents(".task").remove(),0==i.find(".task:not(.task--add)").length&&t(".js-add-task").focus(),s(),!t("body").hasClass("mobile")&&i.find(".task--add").hasClass("task--fixed")){var l=t(window),r=l.height(),c=l.scrollTop(),f=i.offset().top,k=i.height()-1,h=i.find(".task--add").innerHeight();c+r-h>f+k&&i.find(".task--add").removeClass("task--fixed")}})}(),function(){i.on("keyup change",".js-edit-task",function(s){var a=t(this),e=a.parents(".task").attr("data-id"),o=a.val(),d=JSON.parse(localStorage.getItem("dosho")),i=d.tasks.filter(function(t){return t.id==e}),n=d.tasks.indexOf(i[0]),l=new Date,r=l.getTime();d.tasks[n].name=o,d.tasks[n].lastChange=r,localStorage.setItem("dosho",JSON.stringify(d)),13==s.keyCode&&a.blur()})}(),function(){t(".js-add-task").on("change",function(){var o=t(this),d=o.val(),n=new Date,l=n.getTime(),r=a(),c=JSON.parse(localStorage.getItem("dosho"));c.tasks.push({id:r,name:d,createdTime:l}),localStorage.setItem("dosho",JSON.stringify(c)),o.val(""),i.find(".task--add").before(e(r,d)),s(),t("body").hasClass("mobile")||t("body").scrollTop(1e6)})}(),function(){if(!t("body").hasClass("mobile")){var s=t(window),a=s.height(),e=s.scrollTop(),o=i.offset().top,d=i.height()-1,n=i.find(".task--add").innerHeight();e+a-n<=o+d&&i.find(".task--add").addClass("task--fixed"),s.on("scroll",function(){e=s.scrollTop(),o=i.offset().top,d=i.height()-1,e+a-n<=o+d?i.find(".task--add").addClass("task--fixed"):i.find(".task--add").removeClass("task--fixed")})}}(),t("body").hasClass("mobile")||t(".js-add-task").focus(),t(".js-add-task").focusin(function(){i.find(".task--add").addClass("task--focus")}),t(".js-add-task").focusout(function(){i.find(".task--add").removeClass("task--focus")})}(jQuery);