!function(t){"use strict";function a(){for(var t="",a="0123456789abcdefghijklmnopqrstuvwxyz",e=0;e<8;e++)t+=a.charAt(Math.floor(Math.random()*a.length));return t}function e(t){var a=n.find('.list[data-id="'+t+'"] .task:not(.task--add)').length,e=n.find('.list[data-id="'+t+'"] .task--completed').length;if(a>0)var s=100*e/a/100;else var s=0;n.find('.list[data-id="'+t+'"] .list__progress').css({"-webkit-transform":"scaleX("+s+")",transform:"scaleX("+s+")"})}function s(t,a){return'<div class="list" data-id="'+t+'"><div class="list__head"><div class="list__wrap"><div class="list__name  js-name">'+a+'</div><div class="list__options"><div class="list__trash  js-remove-list"><svg><use xlink:href="#icon-trash"></use></svg></div></div><div class="list__progress"></div></div><div class="list__grid  grid"></div></div><div class="list__tasks"><label class="task  task--add"><div class="task__wrap"><div class="task__status"><div class="task__plus"><svg><use xlink:href="#icon-plus"></use></svg></div></div><div class="task__name"><input class="task__input  js-add-task" type="text"></div></div><div class="task__grid  grid"></div></label></div></div>'}function i(t,a,e,s){if(1==e)var e=" task--completed";else var e="";return'<div class="task'+e+'" data-id="'+t+'"><div class="task__wrap"><div class="task__status"><div class="task__check  js-completed-task"></div></div><div class="task__name  js-name">'+a+'</div><div class="task__options"><div class="task__trash  js-remove-task"><svg><use xlink:href="#icon-trash"></use></svg></div></div></div><div class="task__grid  grid">'+d("task",s)+"</div></div>"}function d(t,a){var e=new Date,s=e.getDay();0==s&&(s=7);var i=1;if(a)for(var d={},l=0;l<a.length;l++){var r=a[l].date;d[r]=a[l].label+"|"+(a[l].completed?1:0)}for(var n="",l=1-s;l<=14-s;l++){var o="",c=new Date,k=c.setDate(e.getDate()+l),g=c.getDate(k),m=c.getMonth(k)+1,_=c.getFullYear(k),f=c.getDay(),v=(g<10?"0"+g:g)+"."+(m<10?"0"+m:m)+"."+_;0==f&&(f=7),e.getDate()==g&&(o+=" grid__date--today",i=0),i&&(o+=" grid__date--past"),6!=f&&7!=f||(o+=" grid__date--holiday"),"task"==t&&(o+=" js-marker-task",d&&v in d&&("bull"==d[v].split("|")[0]&&(o+=" grid__date--bull"),1==d[v].split("|")[1]&&(o+=" grid__date--completed"))),n+='<div class="grid__date'+o+'" data-date="'+v+'">',"list"==t&&(n+=g),n+="</div>"}return n}if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){t("body").addClass("mobile");var l=1}var r=t(".board__theme"),n=t(".board__lists");!function(){if(localStorage.getItem("mahoweek")){var t=JSON.parse(localStorage.getItem("mahoweek"));if(r.addClass("board__theme--"+t.settings.theme),!t.lists){var e=a();t.lists=[{id:e,name:"Краткосрочный план дел",createdTime:(new Date).getTime()}];for(var s=0;s<t.tasks.length;s++)t.tasks[s].listId=e;localStorage.setItem("mahoweek",JSON.stringify(t))}void 0===t.settings.theme&&(t.settings.theme="leaves",r.addClass("board__theme--"+t.settings.theme),localStorage.setItem("mahoweek",JSON.stringify(t)))}else{var i={lists:[{id:a(),name:"Краткосрочный план дел",createdTime:(new Date).getTime()}],tasks:[],settings:{theme:"leaves"}};localStorage.setItem("mahoweek",JSON.stringify(i)),r.addClass("board__theme--leaves")}}(),function(){var a=0,e=0,s=l?"touchstart":"mousedown";n.on(s,".js-name",function(t){if("touchstart"==t.type){var e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];a=e.pageX+e.pageY}else a=t.pageX+t.pageY;n.find(".js-add-task").blur()});var i=l?"touchend":"mouseup";n.on(i,".js-name",function(s){var i=t(this);if("touchend"==s.type){var d=s.originalEvent.touches[0]||s.originalEvent.changedTouches[0];e=d.pageX+d.pageY}else e=s.pageX+s.pageY;if("mouseup"==s.type&&1!=s.which)return!1;if(a==e){if(i.hasClass("list__name")&&!i.parents(".list").find(".list__input").length){var l=i.text();i.html('<input class="list__input  js-edit-list" type="text" maxlength="100" value="">'),i.parents(".list").find(".list__input").focus().val(l),i.parents(".list").find(".list__input").focusout(function(){i.text(t(this).val())})}if(i.hasClass("task__name")&&!i.parents(".task").find(".task__input").length){var r=i.text();i.html('<input class="task__input  js-edit-task" type="text" maxlength="100" value="">'),i.parents(".task").find(".task__input").focus().val(r),i.parents(".task").find(".task__input").focusout(function(){i.text(t(this).val())})}}})}(),function(){for(var t=JSON.parse(localStorage.getItem("mahoweek")),a="",e=0;e<t.lists.length;e++)a+=s(t.lists[e].id,t.lists[e].name);n.prepend(a)}(),n.find(".list__grid").html(d("list")),n.find(".task__grid").html(d()),function(){t(".js-add-list").on("click",function(){var e=a(),i="Краткосрочный план дел №"+(n.find(".list").length+1),l=(new Date).getTime(),r=JSON.parse(localStorage.getItem("mahoweek"));r.lists.push({id:e,name:i,createdTime:l}),localStorage.setItem("mahoweek",JSON.stringify(r)),n.append(s(e,i));var o=n.find(".list:last-child");o.find(".list__grid").html(d("list")),o.find(".task__grid").html(d()),o.find(".js-add-task").focus();var c=t(window);o.offset().top>c.scrollTop()+c.height()-30-80&&t("body").scrollTop(o.offset().top)})}(),function(){n.on("keyup change",".js-edit-list",function(a){var e=t(this),s=e.parents(".list").attr("data-id"),i=e.val(),d=JSON.parse(localStorage.getItem("mahoweek")),l=d.lists.filter(function(t){return t.id==s}),r=d.lists.indexOf(l[0]);d.lists[r].name=i,localStorage.setItem("mahoweek",JSON.stringify(d)),13==a.keyCode&&e.blur()})}(),function(){n.on("click",".js-remove-list",function(){var a=t(this),e=a.parents(".list").attr("data-id"),s=a.parents(".list").find(".task:not(.task--add)").length;if(s)var i=confirm("При удалении списка, все дела, находящиеся в нём, так же будут удалены.");if(!s||i){var d=JSON.parse(localStorage.getItem("mahoweek")),l=d.lists.filter(function(t){return t.id==e}),r=d.lists.indexOf(l[0]);if(d.lists.splice(r,1),s){for(var n=[],o=0;o<d.tasks.length;o++)d.tasks[o].listId!=e&&n.push(d.tasks[o]);d.tasks=n}localStorage.setItem("mahoweek",JSON.stringify(d)),a.parents(".list").remove()}})}(),function(){Sortable.create(document.querySelector(".board__lists"),{delay:200,animation:0,handle:".list__name",filter:".list__input",preventOnFilter:!1,ghostClass:"list--ghost",chosenClass:"list--chosen",dragClass:"list--drag",scrollSensitivity:80,onChoose:function(){n.addClass("board__lists--drag")},onEnd:function(t){if(Number.isInteger(t.oldIndex)&&Number.isInteger(t.newIndex)&&t.oldIndex!=t.newIndex){var a=JSON.parse(localStorage.getItem("mahoweek")),e=a.lists.splice(t.oldIndex,1)[0];void 0!==e?(a.lists.splice(t.newIndex,0,e),localStorage.setItem("mahoweek",JSON.stringify(a))):location.reload()}n.removeClass("board__lists--drag")}})}(),function(){for(var t=JSON.parse(localStorage.getItem("mahoweek")),a=0;a<t.tasks.length;a++){n.find('.list[data-id="'+t.tasks[a].listId+'"] .task--add').before(i(t.tasks[a].id,t.tasks[a].name,t.tasks[a].completed,t.tasks[a].markers));var s=n.find('.task[data-id="'+t.tasks[a].id+'"]');s.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length&&s.addClass("task--today")}for(var a=0;a<t.lists.length;a++)e(t.lists[a].id)}(),function(){n.find(".js-add-task").focusin(function(){var a=t(this);a.parents(".task--add").addClass("task--focus")}),n.find(".js-add-task").focusout(function(){var a=t(this);a.parents(".task--add").removeClass("task--focus")})}(),function(){n.on("change",".js-add-task",function(){var s=t(this),d=s.parents(".list").attr("data-id"),l=s.val(),r=(new Date).getTime(),n=a(),o=JSON.parse(localStorage.getItem("mahoweek"));o.tasks.push({id:n,listId:d,name:l,createdTime:r}),localStorage.setItem("mahoweek",JSON.stringify(o)),s.val(""),s.parents(".task--add").before(i(n,l)),e(d);var c=s.parents(".task--add").prev(),k=t(window);c.offset().top>k.scrollTop()+k.height()-30-40-39&&t("body").scrollTop(k.scrollTop()+c.outerHeight(!0))})}(),function(){n.on("click",".js-completed-task",function(){var a=t(this),s=a.parents(".task"),i=s.parents(".list").attr("data-id"),d=s.attr("data-id"),l=s.hasClass("task--completed"),r=s.find(".grid__date--today").attr("data-date"),n=JSON.parse(localStorage.getItem("mahoweek")),o=n.tasks.filter(function(t){return t.id==d}),c=n.tasks.indexOf(o[0]);if(l){s.find(".grid__date--today").removeClass("grid__date--completed");var k="del";delete n.tasks[c].completed,delete n.tasks[c].completedTime,s.removeClass("task--completed")}else{if(s.find(".grid__date--today").toggleClass("grid__date--completed"),s.find(".grid__date--today").hasClass("grid__date--completed"))var k="add";else var k="del";if(s.find(".grid__date--today").hasClass("grid__date--bull")&&!s.find(".grid__date--today").nextAll(".grid__date--bull").length||!s.find(".grid__date--today").hasClass("grid__date--bull")&&s.find(".grid__date--today").nextAll(".grid__date--bull").length<=1){s.find(".grid__date--today").addClass("grid__date--completed"),k="add";var g=(new Date).getTime();n.tasks[c].completed=1,n.tasks[c].completedTime=g,s.addClass("task--completed")}}if(s.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length?s.addClass("task--today"):s.removeClass("task--today"),"add"!=k||n.tasks[c].markers){var m=n.tasks[c].markers.filter(function(t){return t.date==r});if(""!=m){var _=n.tasks[c].markers.indexOf(m[0]);"add"==k?n.tasks[c].markers[_].completed=1:n.tasks[c].markers[_].label?delete n.tasks[c].markers[_].completed:n.tasks[c].markers.splice(_,1)}else"add"==k&&n.tasks[c].markers.push({date:r,completed:1})}else n.tasks[c].markers=[{date:r,completed:1}];localStorage.setItem("mahoweek",JSON.stringify(n)),e(i)})}(),function(){n.on("keyup change",".js-edit-task",function(a){var e=t(this),s=e.parents(".task").attr("data-id"),i=e.val(),d=JSON.parse(localStorage.getItem("mahoweek")),l=d.tasks.filter(function(t){return t.id==s}),r=d.tasks.indexOf(l[0]);d.tasks[r].name=i,localStorage.setItem("mahoweek",JSON.stringify(d)),13==a.keyCode&&e.blur()})}(),function(){n.on("click",".js-remove-task",function(){var a=t(this),s=a.parents(".list").attr("data-id"),i=a.parents(".task").attr("data-id"),d=JSON.parse(localStorage.getItem("mahoweek")),l=d.tasks.filter(function(t){return t.id==i}),r=d.tasks.indexOf(l[0]);d.tasks.splice(r,1),localStorage.setItem("mahoweek",JSON.stringify(d)),a.parents(".task").remove(),e(s)})}(),function(){n.on("click",".task:not(.task--completed) .js-marker-task:not(.grid__date--past):not(.grid__date--completed)",function(){var a=t(this),e=a.parents(".task").attr("data-id"),s=a.attr("data-date"),i=JSON.parse(localStorage.getItem("mahoweek")),d=i.tasks.filter(function(t){return t.id==e}),l=i.tasks.indexOf(d[0]);if(i.tasks[l].markers){var r=i.tasks[l].markers.filter(function(t){return t.date==s});if(""!=r){var n=i.tasks[l].markers.indexOf(r[0]);i.tasks[l].markers.splice(n,1),a.removeClass("grid__date--bull")}else i.tasks[l].markers.push({date:s,label:"bull"}),a.addClass("grid__date--bull")}else i.tasks[l].markers=[{date:s,label:"bull"}],a.addClass("grid__date--bull");a.parents(".task").find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length?a.parents(".task").addClass("task--today"):a.parents(".task").removeClass("task--today"),localStorage.setItem("mahoweek",JSON.stringify(i))})}()}(jQuery);