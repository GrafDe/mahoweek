!function(e){"use strict";function t(){var t="/favicon-32x32.png?v=3",a="/img/favicon-today.png?v=2";e("link[rel$=icon]").remove();var s=JSON.parse(localStorage.getItem("mahoweek")),i=s.settings.faviconCounter,n=p.find(".task--today").length;n>0&&i===!0?(e("head").append(e('<link rel="icon" type="image/png" sizes="32x32">').attr("href",a)),Tinycon.setBubble(n)):e("head").append(e('<link rel="icon" type="image/png" sizes="32x32">').attr("href",t))}function a(){for(var e="",t="0123456789abcdefghijklmnopqrstuvwxyz",a=0;a<8;a++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function s(e){e.settings.updatedTime=(new Date).getTime(),localStorage.setItem("mahoweek",JSON.stringify(e))}function i(e,t){var a=new Date,s=a.getDay();0==s&&(s=7);var i=1;if(t)for(var n={},o=0;o<t.length;o++){var r=t[o].date;n[r]=t[o].label+"|"+(t[o].completed?1:0)}for(var d="",o=1-s;o<=14-s;o++){var l="",c=new Date,f=c.setDate(a.getDate()+o),g=c.getDate(f),m=c.getMonth(f)+1,u=c.getFullYear(f),p=c.getDay(),k=u+"-"+(m<10?"0"+m:m)+"-"+(g<10?"0"+g:g);0==p&&(p=7),a.getDate()==g&&(l+=" grid__date--today",i=0),i&&(l+=" grid__date--past"),6!=p&&7!=p||(l+=" grid__date--holiday"),"task"==e&&(l+=" js-marker-task",n&&k in n&&("bull"==n[k].split("|")[0]&&(l+=" grid__date--bull"),1==n[k].split("|")[1]&&(l+=" grid__date--completed"))),d+='<div class="grid__date'+l+'" data-date="'+k+'">',"list"==e&&(d+=g),d+="</div>"}return d}function n(e){var t=p.find('.list[data-id="'+e+'"] .task:not(.task--add)').length,a=p.find('.list[data-id="'+e+'"] .task--completed').length;if(t>0)var s=100*a/t/100;else var s=0;p.find('.list[data-id="'+e+'"] .list__progress').css({"-webkit-transform":"scaleX("+s+")",transform:"scaleX("+s+")"})}function o(e,t){return'<div class="list" data-id="'+e+'"><div class="list__head"><div class="list__wrap"><div class="list__name  js-name">'+t+'</div><div class="list__options"><div class="list__trash  js-remove-list"><svg><use xlink:href="#icon-trash"></use></svg></div></div><div class="list__progress"></div></div><div class="list__grid  grid"></div></div><div class="list__tasks"><label class="task  task--add"><div class="task__wrap"><div class="task__status"><div class="task__plus"><svg><use xlink:href="#icon-plus"></use></svg></div></div><div class="task__name"><input class="task__input  js-add-task" type="text" maxlength="255"></div></div><div class="task__grid  grid"></div></label></div></div>'}function r(e){e.find(".grid__date.grid__date--past.grid__date--bull:not(.grid__date--completed)").length&&!e.find(".grid__date.grid__date--today.grid__date--completed").length&&e.find(".grid__date.grid__date--past.grid__date--bull:not(.grid__date--completed):last").index()>e.find(".grid__date.grid__date--past.grid__date--completed:last").index()?e.addClass("task--past"):e.removeClass("task--past"),e.find(".grid__date:not(.grid__date--past):not(.grid__date--completed).grid__date--bull").length?e.addClass("task--bull"):e.removeClass("task--bull"),e.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length?e.addClass("task--today"):e.removeClass("task--today")}function d(e){var t=e;return t=/https:\/\/mahoweek\.ru\/#/.test(e)?t.replace(/(https:\/\/)(mahoweek\.ru\/#)([\S]+[^ ,\.!])/gi,'<a href="#$3" class="cartonbox" data-cb-type="inline" data-cb-hash="$3"><span class="hidden">$1</span>$2$3</a>'):t.replace(/(http(s)?:\/\/(www\.)?)([\S]+[^ ,\.!])/gi,'<a href="$1$4" class="js-link-task" target="_blank" rel="noopener noreferrer"><span class="hidden">$1</span>$4</a>'),t=t.replace(/(.+)?(\s)?((2[0-3]|[0-1]\d):([0-5]\d))(\s)?(.+)?/gi,'<span class="task__time">$3</span> $1$7').trim(),/[!]{3,}/.test(e)&&(t="<strong>"+t.replace(/([!]{3,})/gi,'<span class="hidden">$1</span>')+"</strong>"),t}function l(e,t,a,s){if(1==a)var a=" task--completed";else var a="";return'<div class="task'+a+'" data-id="'+e+'"><div class="task__wrap"><div class="task__status"><div class="task__check  js-completed-task"></div></div><div class="task__name  js-name">'+d(t)+'</div><div class="task__options"><div class="task__trash  js-remove-task"><svg><use xlink:href="#icon-trash"></use></svg></div></div></div><div class="task__grid  grid">'+i("task",s)+"</div></div>"}if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){var c=!0;e("body").addClass("mobile")}var f=(navigator.userAgent.toLowerCase().indexOf("firefox")>-1,/^((?!chrome).)*safari/i.test(navigator.userAgent)),g=(/chrom(e|ium)/.test(navigator.userAgent.toLowerCase()),navigator.userAgent.match("CriOS"),navigator.userAgent.match("MSIE")),m=(navigator.userAgent.toLowerCase().indexOf("android")>-1,null!==navigator.userAgent.match(/iPad/i),navigator.platform.toUpperCase().indexOf("WIN")!==-1,navigator.platform.toUpperCase().indexOf("MAC")!==-1,navigator.platform.toUpperCase().indexOf("LINUX")!==-1,e(".board")),u=m.find(".board__theme"),p=m.find(".board__lists"),k=e(".form--settings"),h=e(".form--storage");!function(){if(localStorage.getItem("mahoweek")){var t=JSON.parse(localStorage.getItem("mahoweek"));u.addClass("board__theme--"+t.settings.theme);for(var s=0;s<t.tasks.length;s++)if(t.tasks[s].markers)for(var i=0;i<t.tasks[s].markers.length;i++)/([\d]{2}).([\d]{2}).([\d]{4})/gi.test(t.tasks[s].markers[i].date)&&(t.tasks[s].markers[i].date=t.tasks[s].markers[i].date.replace(/([\d]{2}).([\d]{2}).([\d]{4})/gi,"$3-$2-$1"));void 0===t.settings.faviconCounter&&(t.settings.faviconCounter=!0),void 0===t.settings.createdTime&&(t.settings.createdTime=(new Date).getTime()),void 0===t.settings.deleteCompletedTasks&&(t.settings.deleteCompletedTasks=!1),void 0===t.settings.updatedTime&&(t.settings.updatedTime=(new Date).getTime()),localStorage.setItem("mahoweek",JSON.stringify(t))}else{var n=a(),o=(new Date).getTime(),r="leaves",d={lists:[{id:n,name:"Краткосрочный план дел",createdTime:o}],tasks:[{id:a(),listId:n,name:"Прочитать справку о сайте: https://mahoweek.ru/#about",createdTime:o},{id:a(),listId:n,name:"Посмотреть как здесь всё устроено: https://mahoweek.ru/#tour",createdTime:o},{id:a(),listId:n,name:"Настроить доску: https://mahoweek.ru/#settings",createdTime:o},{id:a(),listId:n,name:"Добавить ещё дел в список",createdTime:o},{id:a(),listId:n,name:"Наметить на календарной сетке даты выполнения задач",createdTime:o}],settings:{createdTime:o,updatedTime:o,deleteCompletedTasks:!1,faviconCounter:!0,theme:r}};localStorage.setItem("mahoweek",JSON.stringify(d)),u.addClass("board__theme--"+r),e("body").attr("data-visit","start")}}(),function(){var t=1e3,a=new Date;setTimeout(function s(){var i=new Date,n=i.getTime(),o=i.getHours(),r=i.getMinutes(),d=(o<10?"0"+o:o)+":"+(r<10?"0"+r:r);a.getDay()!=i.getDay()&&window.location.reload(!0);var l=localStorage.getItem("notify");if(l&&"none"!=l&&"granted"===Notification.permission){var l=1*l;if(9e5==l)var c="15 минут",f=12e4;else if(18e5==l)var c="30 минут",f=3e5;else if(36e5==l)var c="1 час",f=6e5;else if(72e5==l)var c="2 часа",f=9e5;p.find(".task__time").each(function(){var t=e(this),a=t.parents(".task"),s=t.text(),i=a.find(".task__name").text();if(i=i.replace(/(\[)((2[0-3]|[0-1]\d):([0-5]\d))(\]) /gi,""),i=i.replace(/[!]{3,}/gi,""),a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length&&s>d)var o=a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").attr("data-date"),r=o+"T"+s+":00";else if(a.find(".grid__date--today + .grid__date--bull").length)var o=a.find(".grid__date--today + .grid__date--bull").attr("data-date"),r=o+"T"+s+":00";if(r&&(!a.attr("data-notify")||a.attr("data-notify")&&a.attr("data-notify")!=r)&&n+l>=Date.parse(r)&&n+l<=Date.parse(r)+f){new Notification("Через "+c+" в "+s,{body:i,icon:"/img/notify.png?v=2",requireInteraction:!0});a.attr("data-notify",r)}})}p.find(".task__time").each(function(){var t=e(this),a=t.parents(".task"),s=t.text();a.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length&&s<=d?a.addClass("task--now"):a.removeClass("task--now")}),setTimeout(s,t)},t)}(),function(){var t=0,a=0,s=c?"touchstart":"mousedown";p.on(s,".js-name",function(e){if("touchstart"==e.type){var a=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t=a.pageX+a.pageY}else t=e.pageX+e.pageY;p.find(".js-add-task").blur()});var i=c?"touchend":"mouseup";p.on(i,".js-name",function(s){var i=e(this);if("touchend"==s.type){var n=s.originalEvent.touches[0]||s.originalEvent.changedTouches[0];a=n.pageX+n.pageY}else a=s.pageX+s.pageY;if("mouseup"==s.type&&1!=s.which)return!1;if(!e(s.target).hasClass("js-link-task")&&!e(s.target).hasClass("cartonbox")&&t==a){if(i.hasClass("list__name")&&!i.parents(".list").find(".list__input").length){var o=i.text();i.html('<input class="list__input  js-edit-list" type="text" maxlength="255" value="">'),i.parents(".list").find(".list__input").val(o).select(),i.parents(".list").find(".list__input").focusout(function(){i.text(e(this).val())})}if(i.hasClass("task__name")&&!i.parents(".task").find(".task__input").length){var r=i.text();i.html('<input class="task__input  js-edit-task" type="text" maxlength="255" value="">'),i.parents(".task").find(".task__input").val(r).focus(),i.parents(".task").find(".task__input").focusout(function(){i.html(d(e(this).val()))})}}})}(),setTimeout(function(){e("body").scrollTop(0)},1),function(){var t={speed:1,preload:!1,closeHtml:'<svg><use xlink:href="#icon-close"></use></svg>',onStartBefore:function(){e(".cartonbox-close").prependTo(".cartonbox-container")},onShowBefore:function(){if("#storage"==window.location.hash){var e=JSON.parse(localStorage.getItem("mahoweek")),e=JSON.stringify(e,"",2);h.find(".js-edit-storage").val(e)}}};e.cartonbox(t),"start"==e("body").attr("data-visit")&&e(".js-open-welcome").trigger("click"),e(".js-close-welcome").on("click",function(){e(".cartonbox-close").trigger("click")})}(),function(){var e={},t=null,a=null,s=null,i=null,n={},o=Math.ceil(window.devicePixelRatio)||1,r=16*o,d={width:16,height:16,font:11*o+"px Courier New",color:"#000",background:"transparent",fallback:!1,crossOrigin:!0,abbreviate:!0},l=function(){var e=navigator.userAgent.toLowerCase();return function(t){return e.indexOf(t)!==-1}}(),c={ie:l("trident"),chrome:l("chrome"),webkit:l("chrome")||l("safari"),safari:l("safari")&&!l("chrome"),mozilla:l("mozilla")&&!l("chrome")&&!l("safari")},f=function(){for(var e=document.getElementsByTagName("link"),t=0,a=e.length;t<a;t++)if((e[t].getAttribute("rel")||"").match(/\bicon\b/i))return e[t];return!1},g=function(){for(var e=document.getElementsByTagName("link"),t=0,a=e.length;t<a;t++){var s="undefined"!=typeof e[t];s&&(e[t].getAttribute("rel")||"").match(/\bicon\b/i)&&e[t].parentNode.removeChild(e[t])}},m=function(){if(!a||!t){var e=f();t=e?e.getAttribute("href"):"/favicon.ico",a||(a=t)}return t},u=function(){return i||(i=document.createElement("canvas"),i.width=r,i.height=r),i},p=function(e){if(e){g();var t=document.createElement("link");t.type="image/x-icon",t.rel="icon",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}},k=function(e,t){if(!u().getContext||c.ie||c.safari||"force"===n.fallback)return h(e);var a=u().getContext("2d"),t=t||"#000000",i=m();s=document.createElement("img"),s.onload=function(){a.clearRect(0,0,r,r),a.drawImage(s,2,2,s.width,s.height,0,0,r,r),(e+"").length>0&&v(a,e,t),_()},!i.match(/^data/)&&n.crossOrigin&&(s.crossOrigin="anonymous"),s.src=i},h=function(e){if(n.fallback){var t=document.title;"("===t[0]&&(t=t.slice(t.indexOf(" "))),(e+"").length>0?document.title="("+e+") "+t:document.title=t}},v=function(e,t,a){"number"==typeof t&&t>99&&n.abbreviate&&(t=b(t));var s=(t+"").length-1,i=n.width*o+6*o*s,d=n.height*o,l=r-d,f=r-i-o,g=16*o,m=16*o,u=2*o;e.font=(c.webkit?"bold ":"")+n.font,e.fillStyle=n.background,e.strokeStyle=n.background,e.lineWidth=o,e.beginPath(),e.moveTo(f+u,l),e.quadraticCurveTo(f,l,f,l+u),e.lineTo(f,g-u),e.quadraticCurveTo(f,g,f+u,g),e.lineTo(m-u,g),e.quadraticCurveTo(m,g,m,g-u),e.lineTo(m,l+u),e.quadraticCurveTo(m,l,m-u,l),e.closePath(),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.textAlign="right",e.textBaseline="top",e.strokeText(t,2===o?32:16,c.mozilla?7*o:6*o),e.fillStyle=n.color,e.textAlign="right",e.textBaseline="top",e.fillText(t,2===o?32:16,c.mozilla?7*o:6*o)},_=function(){u().getContext&&p(u().toDataURL())},b=function(e){for(var t=[["G",1e9],["M",1e6],["k",1e3]],a=0;a<t.length;++a)if(e>=t[a][1]){e=w(e/t[a][1])+t[a][0];break}return e},w=function(e,t){var a=new Number(e);return a.toFixed(t)};e.setOptions=function(e){n={},e.colour&&(e.color=e.colour);for(var t in d)n[t]=e.hasOwnProperty(t)?e[t]:d[t];return this},e.setImage=function(e){return t=e,_(),this},e.setBubble=function(e,t){return e=e||"",k(e,t),this},e.reset=function(){t=a,p(a)},e.setOptions(d),"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module?module.exports=e:window.Tinycon=e}(),function(){if(document.createElement("canvas").getContext&&!g&&!f){k.find(".js-choose-favicon-counter").parents(".form__group").removeClass("form__group--hidden");var e=JSON.parse(localStorage.getItem("mahoweek")),a=e.settings.faviconCounter;a===!0?k.find(".js-choose-favicon-counter").attr("checked","checked"):k.find(".js-choose-favicon-counter").removeAttr("checked","checked"),k.find(".js-choose-favicon-counter").on("change",function(){a=k.find(".js-choose-favicon-counter").prop("checked"),e=JSON.parse(localStorage.getItem("mahoweek")),e.settings.faviconCounter=a,s(e),t()})}}(),function(){"Notification"in window&&(k.find(".js-choose-notify").parents(".form__group").removeClass("form__group--hidden"),localStorage.getItem("notify")&&"none"!=localStorage.getItem("notify")&&"granted"===Notification.permission&&k.find('.js-choose-notify option[value="'+localStorage.getItem("notify")+'"]').attr("selected","selected"),k.find(".js-choose-notify").on("change",function(){var t=e(this).val();"none"==t?localStorage.setItem("notify","none"):"granted"===Notification.permission?localStorage.setItem("notify",t):"default"===Notification.permission?Notification.requestPermission(function(e){if("granted"===e){localStorage.setItem("notify",t);new Notification("Оповещения включены",{body:"Теперь добавьте время выполнения делам и держите сайт открытым в браузере, чтобы оповещения приходили.",icon:"/img/notify.png?v=2",requireInteraction:!0})}else localStorage.setItem("notify","none"),k.find(".js-choose-notify option").removeAttr("selected","selected")}):"denied"===Notification.permission&&(alert("Ранее вы блокировали отправку вам оповещений. Пожалуйста, разрешите оповещения в настройках сайта в браузере."),k.find(".js-choose-notify option").removeAttr("selected","selected"))}))}(),function(){k.on("submit",function(e){e.preventDefault()});var e=JSON.parse(localStorage.getItem("mahoweek")),t=e.settings.theme,a=e.settings.deleteCompletedTasks;k.find('.js-choose-theme[value="'+t+'"]').attr("checked","checked"),a===!0?k.find(".js-choose-delete-completed-tasks").attr("checked","checked"):k.find(".js-choose-delete-completed-tasks").removeAttr("checked","checked"),k.find(".js-choose-theme, .js-choose-delete-completed-tasks").on("change",function(){t=k.find('.js-choose-theme[name="theme"]:checked').val(),a=k.find(".js-choose-delete-completed-tasks").prop("checked"),u.attr("class","board__theme  board__theme--"+t),e=JSON.parse(localStorage.getItem("mahoweek")),e.settings.theme=t,e.settings.deleteCompletedTasks=a,s(e)})}(),function(){h.on("submit",function(e){e.preventDefault();var t=h.find(".js-edit-storage").val();if(""!=t&&JSON.parse(t)){var a=JSON.parse(t);localStorage.setItem("mahoweek",JSON.stringify(a)),window.location.replace("/")}else""==t&&(localStorage.clear(),window.location.replace("/"))})}(),function(){p.on("click",".js-marker-task:not(.grid__date--past):not(.grid__date--completed)",function(){var a=e(this),i=a.parents(".task"),o=i.parents(".list").attr("data-id"),d=i.attr("data-id"),l=a.attr("data-date"),c=JSON.parse(localStorage.getItem("mahoweek")),f=c.tasks.filter(function(e){return e.id==d}),g=c.tasks.indexOf(f[0]);if(c.tasks[g].markers){var m=c.tasks[g].markers.filter(function(e){return e.date==l});if(""!=m){var u=c.tasks[g].markers.indexOf(m[0]);c.tasks[g].markers.splice(u,1),a.removeClass("grid__date--bull")}else c.tasks[g].markers.push({date:l,label:"bull"}),a.addClass("grid__date--bull"),i.hasClass("task--completed")&&(delete c.tasks[g].completed,delete c.tasks[g].completedTime,i.removeClass("task--completed"))}else c.tasks[g].markers=[{date:l,label:"bull"}],a.addClass("grid__date--bull"),i.hasClass("task--completed")&&(delete c.tasks[g].completed,delete c.tasks[g].completedTime,i.removeClass("task--completed"));s(c),r(i),n(o),t()})}(),function(){for(var e="",t=JSON.parse(localStorage.getItem("mahoweek")),a=0;a<t.lists.length;a++)e+=o(t.lists[a].id,t.lists[a].name);p.prepend(e)}(),p.find(".list__grid").html(i("list")),p.find(".task__grid").html(i()),function(){e(".js-add-list").on("click",function(){var t=a(),n="Краткосрочный план дел №"+(p.find(".list").length+1),r=(new Date).getTime(),d=JSON.parse(localStorage.getItem("mahoweek"));d.lists.push({id:t,name:n,createdTime:r}),s(d),p.append(o(t,n));var l=p.find(".list:last-child");l.find(".list__grid").html(i("list")),l.find(".task__grid").html(i()),l.find(".js-add-task").focus();var c=e(window);l.offset().top>c.scrollTop()+c.height()-30-80&&e("body").scrollTop(l.offset().top)})}(),function(){p.on("keyup change",".js-edit-list",function(t){var a=e(this);if(13==t.keyCode||"change"==t.type){var i=a.parents(".list").attr("data-id"),n=a.val(),o=JSON.parse(localStorage.getItem("mahoweek")),r=o.lists.filter(function(e){return e.id==i}),d=o.lists.indexOf(r[0]);o.lists[d].name=n,s(o),a.blur()}})}(),function(){p.on("click",".js-remove-list",function(){var a=e(this),i=a.parents(".list").attr("data-id"),n=a.parents(".list").find(".task:not(.task--add)").length;if(n)var o=confirm("При удалении списка, все дела, находящиеся в нём, так же будут удалены.");if(!n||o){var r=JSON.parse(localStorage.getItem("mahoweek")),d=r.lists.filter(function(e){return e.id==i}),l=r.lists.indexOf(d[0]);if(r.lists.splice(l,1),n){for(var c=[],f=0;f<r.tasks.length;f++)r.tasks[f].listId!=i&&c.push(r.tasks[f]);r.tasks=c}s(r),a.parents(".list").remove(),t()}})}(),function(){var e=c?200:0;Sortable.create(document.querySelector(".board__lists"),{delay:e,animation:0,handle:".list__name",filter:".list__input",preventOnFilter:!1,ghostClass:"list--ghost",chosenClass:"list--chosen",dragClass:"list--drag",scrollSensitivity:80,onClone:function(){p.addClass("board__lists--drag")},onEnd:function(e){if(Number.isInteger(e.oldIndex)&&Number.isInteger(e.newIndex)&&e.oldIndex>=0&&e.newIndex>=0&&e.oldIndex!=e.newIndex){var t=JSON.parse(localStorage.getItem("mahoweek"));if(void 0!==t.lists[e.oldIndex]&&void 0!==t.lists[e.newIndex]){var a=t.lists.splice(e.oldIndex,1)[0];t.lists.splice(e.newIndex,0,a),s(t)}else window.location.reload(!0)}p.removeClass("board__lists--drag")}})}(),function(){var e=(new Date).getDay();0==e&&(e=7);var a=new Date;a.setDate(a.getDate()-e),a.setHours(23,59,59,999);for(var i=a.getTime(),o=[],d=JSON.parse(localStorage.getItem("mahoweek")),c=0;c<d.tasks.length;c++)if(!(d.settings.deleteCompletedTasks&&d.tasks[c].completed&&d.tasks[c].completedTime<=i)){o.push(d.tasks[c]),p.find('.list[data-id="'+d.tasks[c].listId+'"] .task--add').before(l(d.tasks[c].id,d.tasks[c].name,d.tasks[c].completed,d.tasks[c].markers));var f=p.find('.task[data-id="'+d.tasks[c].id+'"]');r(f)}for(var c=0;c<d.lists.length;c++)n(d.lists[c].id);d.tasks.length!=o.length&&(d.tasks=o,s(d)),m.addClass("board--load"),t()}(),function(){p.find(".js-add-task").focusin(function(){var t=e(this);t.parents(".task--add").addClass("task--focus")}),p.find(".js-add-task").focusout(function(){var t=e(this);t.parents(".task--add").removeClass("task--focus")})}(),function(){p.on("change",".js-add-task",function(){var t=e(this),i=t.parents(".list").attr("data-id"),o=a(),r=t.val(),d=(new Date).getTime(),c=JSON.parse(localStorage.getItem("mahoweek"));c.tasks.push({id:o,listId:i,name:r,createdTime:d}),s(c),t.val(""),t.parents(".task--add").before(l(o,r)),n(i);var f=t.parents(".task--add").prev(),g=e(window);f.offset().top>g.scrollTop()+g.height()-30-40-39&&e("body").scrollTop(g.scrollTop()+f.outerHeight(!0))})}(),function(){p.on("click",".js-completed-task",function(){var a=e(this),i=a.parents(".task"),o=i.parents(".list").attr("data-id"),d=i.attr("data-id"),l=i.hasClass("task--completed"),c=i.find(".grid__date--today").attr("data-date"),f=JSON.parse(localStorage.getItem("mahoweek")),g=f.tasks.filter(function(e){return e.id==d}),m=f.tasks.indexOf(g[0]);if(l){i.find(".grid__date--today").removeClass("grid__date--completed");var u="del";delete f.tasks[m].completed,delete f.tasks[m].completedTime,i.removeClass("task--completed")}else{if(i.find(".grid__date--today").toggleClass("grid__date--completed"),i.find(".grid__date--today").hasClass("grid__date--completed"))var u="add";else var u="del";if(!i.find(".grid__date--today").nextAll(".grid__date--bull").length){i.find(".grid__date--today").addClass("grid__date--completed"),u="add";var p=(new Date).getTime();f.tasks[m].completed=1,f.tasks[m].completedTime=p,i.addClass("task--completed")}}if("add"!=u||f.tasks[m].markers){var k=f.tasks[m].markers.filter(function(e){return e.date==c});if(""!=k){var h=f.tasks[m].markers.indexOf(k[0]);"add"==u?f.tasks[m].markers[h].completed=1:f.tasks[m].markers[h].label?delete f.tasks[m].markers[h].completed:f.tasks[m].markers.splice(h,1)}else"add"==u&&f.tasks[m].markers.push({date:c,completed:1})}else f.tasks[m].markers=[{date:c,completed:1}];s(f),r(i),n(o),t()})}(),function(){p.on("keyup change",".js-edit-task",function(t){var a=e(this);if(13==t.keyCode||"change"==t.type){var i=a.parents(".task").attr("data-id"),n=a.val(),o=JSON.parse(localStorage.getItem("mahoweek")),r=o.tasks.filter(function(e){return e.id==i}),d=o.tasks.indexOf(r[0]);o.tasks[d].name=n,s(o),a.blur()}})}(),function(){p.on("click",".js-remove-task",function(){var a=e(this),i=a.parents(".list").attr("data-id"),o=a.parents(".task").attr("data-id"),r=JSON.parse(localStorage.getItem("mahoweek")),d=r.tasks.filter(function(e){return e.id==o}),l=r.tasks.indexOf(d[0]);r.tasks.splice(l,1),s(r),a.parents(".task").remove(),n(i),t()})}()}(jQuery);