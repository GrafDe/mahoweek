!function(t){"use strict";function a(){var a=t(".task:not(.task--add)").length,e=t('.task:not(.task--add)[data-completed="1"]').length;if(a>0)var s=100*e/a/100;else var s=0;i.find(".list__progress").css({"-webkit-transform":"scaleX("+s+")",transform:"scaleX("+s+")"})}function e(){for(var t="",a="0123456789abcdefghijklmnopqrstuvwxyz",e=0;e<8;e++)t+=a.charAt(Math.floor(Math.random()*a.length));return t}function s(t,a,e){if(1==e)var e=' data-completed="1"';else var e="";return'<div class="task" data-id="'+t+'"'+e+'><div class="task__status"><div class="task__check  js-completed-task"></div></div><div class="task__name">'+a+'</div><div class="task__options"><div class="task__trash  js-remove-task"><svg><use xlink:href="#ei-trash-icon"></use></svg></div></div></div>'}if(!localStorage.getItem("mahoweek")){var o={tasks:[],settings:{}};localStorage.setItem("mahoweek",JSON.stringify(o))}/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&t("body").addClass("mobile");var i=t(".list");!function(){if(!t("body").hasClass("mobile")){var a=t(window),e=a.scrollTop(),s=i.offset().top;a.on("scroll",function(){var a=t(this);e=a.scrollTop(),e>=s?i.find(".list__head").addClass("list__head--fixed"):i.find(".list__head").removeClass("list__head--fixed")})}}();var n=t(".list__tasks");!function(){for(var t=JSON.parse(localStorage.getItem("mahoweek")),e="",o=0;o<t.tasks.length;o++)e+=s(t.tasks[o].id,t.tasks[o].name,t.tasks[o].completed);n.prepend(e),a()}(),function(){if(!t("body").hasClass("mobile")){var a=t(window),e=a.height(),s=a.scrollTop(),o=n.offset().top,i=n.height()-1,d=n.find(".task--add").innerHeight();s+e-d<=o+i&&n.find(".task--add").addClass("task--fixed"),a.on("scroll resize",function(){var a=t(this);s=a.scrollTop(),e=a.height(),o=n.offset().top,i=n.height()-1,s+e-d<=o+i?n.find(".task--add").addClass("task--fixed"):n.find(".task--add").removeClass("task--fixed")})}}(),function(){t("body").hasClass("mobile")||n.find(".js-add-task").focus(),n.find(".js-add-task").focusin(function(){var a=t(this);a.parents(".task--add").addClass("task--focus")}),n.find(".js-add-task").focusout(function(){var a=t(this);a.parents(".task--add").removeClass("task--focus")})}(),function(){t(".js-add-task").on("change",function(){var o=t(this),i=o.val(),d=(new Date).getTime(),r=e(),l=JSON.parse(localStorage.getItem("mahoweek"));l.tasks.push({id:r,name:i,createdTime:d}),localStorage.setItem("mahoweek",JSON.stringify(l)),o.val(""),n.find(".task--add").before(s(r,i)),a(),t("body").hasClass("mobile")||t("body").scrollTop(1e4)})}(),function(){n.on("click",".js-completed-task",function(){var e=t(this),s=e.parents(".task").attr("data-id"),o=e.parents(".task").attr("data-completed"),i=JSON.parse(localStorage.getItem("mahoweek")),n=i.tasks.filter(function(t){return t.id==s}),d=i.tasks.indexOf(n[0]);if(o)delete i.tasks[d].completed,delete i.tasks[d].completedTime,e.parents(".task").removeAttr("data-completed");else{var r=(new Date).getTime();i.tasks[d].completed=1,i.tasks[d].completedTime=r,e.parents(".task").attr("data-completed",1)}localStorage.setItem("mahoweek",JSON.stringify(i)),a()})}(),function(){var a=0,e=0,s=t("body").hasClass("mobile")?"touchstart":"mousedown";n.on(s,".task:not(.task--add) .task__name",function(t){if("touchstart"==t.type){var e=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];a=e.pageX+e.pageY}else a=t.pageX+t.pageY;n.find(".js-add-task").blur()});var o=t("body").hasClass("mobile")?"touchend":"mouseup";n.on(o,".task:not(.task--add) .task__name",function(s){var o=t(this);if("touchend"==s.type){var i=s.originalEvent.touches[0]||s.originalEvent.changedTouches[0];e=i.pageX+i.pageY}else e=s.pageX+s.pageY;if("mouseup"==s.type&&1!=s.which)return!1;if(a==e&&!o.parents(".task").find(".task__input").length){var n=o.text();o.html('<input class="task__input  js-edit-task" type="text" maxlength="100" value="">'),o.parents(".task").find(".task__input").focus().val(n),o.parents(".task").find(".task__input").focusout(function(){o.text(t(this).val())})}})}(),function(){n.on("keyup change",".js-edit-task",function(a){var e=t(this),s=e.parents(".task").attr("data-id"),o=e.val(),i=JSON.parse(localStorage.getItem("mahoweek")),n=i.tasks.filter(function(t){return t.id==s}),d=i.tasks.indexOf(n[0]),r=(new Date).getTime();i.tasks[d].name=o,i.tasks[d].lastChange=r,localStorage.setItem("mahoweek",JSON.stringify(i)),13==a.keyCode&&e.blur()})}(),function(){n.on("click",".js-remove-task",function(){var e=t(this),s=e.parents(".task").attr("data-id"),o=JSON.parse(localStorage.getItem("mahoweek")),i=o.tasks.filter(function(t){return t.id==s}),d=o.tasks.indexOf(i[0]);if(o.tasks.splice(d,1),localStorage.setItem("mahoweek",JSON.stringify(o)),e.parents(".task").remove(),0==n.find(".task:not(.task--add)").length&&n.find(".js-add-task").focus(),a(),!t("body").hasClass("mobile")&&n.find(".task--add").hasClass("task--fixed")){var r=t(window),l=r.height(),c=r.scrollTop(),k=n.offset().top,f=n.height()-1,h=n.find(".task--add").innerHeight();c+l-h>k+f&&n.find(".task--add").removeClass("task--fixed")}})}(),function(){Sortable.create(document.querySelector(".list__tasks"),{delay:200,animation:0,filter:".task--add, .task__input",preventOnFilter:!1,ghostClass:"task--ghost",chosenClass:"task--chosen",dragClass:"task--drag",scrollSensitivity:80,onChoose:function(){n.addClass("list__tasks--drag")},onEnd:function(t){if(Number.isInteger(t.oldIndex)&&Number.isInteger(t.newIndex)&&t.oldIndex!=t.newIndex){var a=JSON.parse(localStorage.getItem("mahoweek"));a.tasks.splice(t.newIndex,0,a.tasks.splice(t.oldIndex,1)[0]),localStorage.setItem("mahoweek",JSON.stringify(a)),n.removeClass("list__tasks--drag")}}})}()}(jQuery);