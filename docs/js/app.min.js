!function(t){"use strict";function e(){var e="/favicon-32x32.png?v=2",a="/img/favicon-today.png",s=g.find(".task--today").length;t("link[rel$=icon]").remove(),s>0?(t("head").append(t('<link rel="icon" type="image/png" sizes="32x32">').attr("href",a)),Tinycon.setBubble(s)):t("head").append(t('<link rel="icon" type="image/png" sizes="32x32">').attr("href",e))}function a(){for(var t="",e="0123456789abcdefghijklmnopqrstuvwxyz",a=0;a<8;a++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}function s(t){var e=g.find('.list[data-id="'+t+'"] .task:not(.task--add)').length,a=g.find('.list[data-id="'+t+'"] .task--completed').length;if(e>0)var s=100*a/e/100;else var s=0;g.find('.list[data-id="'+t+'"] .list__progress').css({"-webkit-transform":"scaleX("+s+")",transform:"scaleX("+s+")"})}function i(t,e){return'<div class="list" data-id="'+t+'"><div class="list__head"><div class="list__wrap"><div class="list__name  js-name">'+e+'</div><div class="list__options"><div class="list__trash  js-remove-list"><svg><use xlink:href="#icon-trash"></use></svg></div></div><div class="list__progress"></div></div><div class="list__grid  grid"></div></div><div class="list__tasks"><label class="task  task--add"><div class="task__wrap"><div class="task__status"><div class="task__plus"><svg><use xlink:href="#icon-plus"></use></svg></div></div><div class="task__name"><input class="task__input  js-add-task" type="text" maxlength="255"></div></div><div class="task__grid  grid"></div></label></div></div>'}function d(t){var e=t;return e=/https:\/\/mahoweek\.ru\/#/.test(t)?e.replace(/(https:\/\/)(mahoweek\.ru\/#)([\S]+[^ ,\.!])/gi,'<a href="#$3" class="cartonbox" data-cb-type="inline" data-cb-hash="$3"><span class="hidden">$1</span>$2$3</a>'):e.replace(/(http(s)?:\/\/(www\.)?)([\S]+[^ ,\.!])/gi,'<a href="$1$4" class="js-link-task" target="_blank" rel="noopener noreferrer"><span class="hidden">$1</span>$4</a>'),e=e.replace(/(.+)?(\s)?(\[)(\d\d:\d\d)(\])(\s)?(.+)?/gi,'<span class="hidden">$3</span><span class="task__time">$4</span><span class="hidden">$5</span> $1$7').trim(),/[!]{3,}/.test(t)&&(e="<strong>"+e.replace(/([!]{3,})/gi,'<span class="hidden">$1</span>')+"</strong>"),e}function n(t,e,a,s){if(1==a)var a=" task--completed";else var a="";return'<div class="task'+a+'" data-id="'+t+'"><div class="task__wrap"><div class="task__status"><div class="task__check  js-completed-task"></div></div><div class="task__name  js-name">'+d(e)+'</div><div class="task__options"><div class="task__trash  js-remove-task"><svg><use xlink:href="#icon-trash"></use></svg></div></div></div><div class="task__grid  grid">'+r("task",s)+"</div></div>"}function r(t,e){var a=new Date,s=a.getDay();0==s&&(s=7);var i=1;if(e)for(var d={},n=0;n<e.length;n++){var r=e[n].date;d[r]=e[n].label+"|"+(e[n].completed?1:0)}for(var l="",n=1-s;n<=14-s;n++){var o="",c=new Date,g=c.setDate(a.getDate()+n),f=c.getDate(g),m=c.getMonth(g)+1,u=c.getFullYear(g),_=c.getDay(),k=(f<10?"0"+f:f)+"."+(m<10?"0"+m:m)+"."+u;0==_&&(_=7),a.getDate()==f&&(o+=" grid__date--today",i=0),i&&(o+=" grid__date--past"),6!=_&&7!=_||(o+=" grid__date--holiday"),"task"==t&&(o+=" js-marker-task",d&&k in d&&("bull"==d[k].split("|")[0]&&(o+=" grid__date--bull"),1==d[k].split("|")[1]&&(o+=" grid__date--completed"))),l+='<div class="grid__date'+o+'" data-date="'+k+'">',"list"==t&&(l+=f),l+="</div>"}return l}if(setTimeout(function(){t("body").scrollTop(0)},1),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){t("body").addClass("mobile");var l=1}var o=t(".board"),c=o.find(".board__theme"),g=o.find(".board__lists"),f=t(".form--settings");!function(){if(localStorage.getItem("mahoweek")){var e=JSON.parse(localStorage.getItem("mahoweek"));c.addClass("board__theme--"+e.settings.theme)}else{var s=a(),i="leaves",d={lists:[{id:s,name:"Краткосрочный план дел",createdTime:(new Date).getTime()}],tasks:[{id:a(),listId:s,name:"Прочитать справку о сайте: https://mahoweek.ru/#about",createdTime:(new Date).getTime()},{id:a(),listId:s,name:"Посмотреть как здесь всё устроено: https://mahoweek.ru/#tour",createdTime:(new Date).getTime()},{id:a(),listId:s,name:"Настроить доску: https://mahoweek.ru/#settings",createdTime:(new Date).getTime()},{id:a(),listId:s,name:"Добавить ещё дел в список",createdTime:(new Date).getTime()},{id:a(),listId:s,name:"Наметить на календарной сетке даты выполнения задач",createdTime:(new Date).getTime()}],settings:{theme:i}};localStorage.setItem("mahoweek",JSON.stringify(d)),c.addClass("board__theme--"+i),t("body").attr("data-visit","first")}}(),function(){var e=0,a=0,s=l?"touchstart":"mousedown";g.on(s,".js-name",function(t){if("touchstart"==t.type){var a=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];e=a.pageX+a.pageY}else e=t.pageX+t.pageY;g.find(".js-add-task").blur()});var i=l?"touchend":"mouseup";g.on(i,".js-name",function(s){var i=t(this);if("touchend"==s.type){var n=s.originalEvent.touches[0]||s.originalEvent.changedTouches[0];a=n.pageX+n.pageY}else a=s.pageX+s.pageY;if("mouseup"==s.type&&1!=s.which)return!1;if(!t(s.target).hasClass("js-link-task")&&!t(s.target).hasClass("cartonbox")&&e==a){if(i.hasClass("list__name")&&!i.parents(".list").find(".list__input").length){var r=i.text();i.html('<input class="list__input  js-edit-list" type="text" maxlength="255" value="">'),i.parents(".list").find(".list__input").val(r).select(),i.parents(".list").find(".list__input").focusout(function(){i.text(t(this).val())})}if(i.hasClass("task__name")&&!i.parents(".task").find(".task__input").length){var l=i.text();i.html('<input class="task__input  js-edit-task" type="text" maxlength="255" value="">'),i.parents(".task").find(".task__input").val(l).focus(),i.parents(".task").find(".task__input").focusout(function(){i.html(d(t(this).val()))})}}})}(),function(){var e={speed:1,preload:!1,closeHtml:'<svg><use xlink:href="#icon-close"></use></svg>',onStartBefore:function(){t(".cartonbox-close").prependTo(".cartonbox-container")}};t.cartonbox(e),"first"==t("body").attr("data-visit")&&t(".js-open-welcome").trigger("click"),t(".js-close-welcome").on("click",function(){t(".cartonbox-close").trigger("click"),o.addClass("board--load")})}(),function(){var t={},e=null,a=null,s=null,i=null,d={},n=Math.ceil(window.devicePixelRatio)||1,r=16*n,l={width:16,height:16,font:8*n+"px Arial",color:"#212121",background:"transparent",fallback:!0,crossOrigin:!0,abbreviate:!0},o=function(){var t=navigator.userAgent.toLowerCase();return function(e){return t.indexOf(e)!==-1}}(),c={ie:o("trident"),chrome:o("chrome"),webkit:o("chrome")||o("safari"),safari:o("safari")&&!o("chrome"),mozilla:o("mozilla")&&!o("chrome")&&!o("safari")},g=function(){for(var t=document.getElementsByTagName("link"),e=0,a=t.length;e<a;e++)if((t[e].getAttribute("rel")||"").match(/\bicon\b/i))return t[e];return!1},f=function(){for(var t=document.getElementsByTagName("link"),e=0,a=t.length;e<a;e++){var s="undefined"!=typeof t[e];s&&(t[e].getAttribute("rel")||"").match(/\bicon\b/i)&&t[e].parentNode.removeChild(t[e])}},m=function(){if(!a||!e){var t=g();e=t?t.getAttribute("href"):"/favicon.ico",a||(a=e)}return e},u=function(){return i||(i=document.createElement("canvas"),i.width=r,i.height=r),i},_=function(t){if(t){f();var e=document.createElement("link");e.type="image/x-icon",e.rel="icon",e.href=t,document.getElementsByTagName("head")[0].appendChild(e)}},k=function(t,e){if(!u().getContext||c.ie||c.safari||"force"===d.fallback)return p(t);var a=u().getContext("2d"),e=e||"#000000",i=m();s=document.createElement("img"),s.onload=function(){a.clearRect(0,0,r,r),a.drawImage(s,0,0,s.width,s.height,0,0,r,r),(t+"").length>0&&h(a,t,e),v()},!i.match(/^data/)&&d.crossOrigin&&(s.crossOrigin="anonymous"),s.src=i},p=function(t){if(d.fallback){var e=document.title;"("===e[0]&&(e=e.slice(e.indexOf(" "))),(t+"").length>0?document.title="("+t+") "+e:document.title=e}},h=function(t,e,a){"number"==typeof e&&e>99&&d.abbreviate&&(e=b(e));var s=(e+"").length-1,i=d.width*n+6*n*s,l=d.height*n,o=r-l,g=r-i-n,f=16*n,m=16*n,u=2*n;t.font=(c.webkit?"bold ":"")+d.font,t.fillStyle=d.background,t.strokeStyle=d.background,t.lineWidth=n,t.beginPath(),t.moveTo(g+u,o),t.quadraticCurveTo(g,o,g,o+u),t.lineTo(g,f-u),t.quadraticCurveTo(g,f,g+u,f),t.lineTo(m-u,f),t.quadraticCurveTo(m,f,m,f-u),t.lineTo(m,o+u),t.quadraticCurveTo(m,o,m-u,o),t.closePath(),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.75)",t.lineWidth=2,t.textAlign="right",t.textBaseline="top",t.strokeText(e,2===n?28:14,c.mozilla?9*n:8*n),t.fillStyle=d.color,t.textAlign="right",t.textBaseline="top",t.fillText(e,2===n?28:14,c.mozilla?9*n:8*n)},v=function(){u().getContext&&_(u().toDataURL())},b=function(t){for(var e=[["G",1e9],["M",1e6],["k",1e3]],a=0;a<e.length;++a)if(t>=e[a][1]){t=w(t/e[a][1])+e[a][0];break}return t},w=function(t,e){var a=new Number(t);return a.toFixed(e)};t.setOptions=function(t){d={},t.colour&&(t.color=t.colour);for(var e in l)d[e]=t.hasOwnProperty(e)?t[e]:l[e];return this},t.setImage=function(t){return e=t,v(),this},t.setBubble=function(t,e){return t=t||"",k(t,e),this},t.reset=function(){e=a,_(a)},t.setOptions(l),"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module?module.exports=t:window.Tinycon=t}(),function(){for(var t=JSON.parse(localStorage.getItem("mahoweek")),e="",a=0;a<t.lists.length;a++)e+=i(t.lists[a].id,t.lists[a].name);g.prepend(e)}(),g.find(".list__grid").html(r("list")),g.find(".task__grid").html(r()),function(){t(".js-add-list").on("click",function(){var e=a(),s="Краткосрочный план дел №"+(g.find(".list").length+1),d=(new Date).getTime(),n=JSON.parse(localStorage.getItem("mahoweek"));n.lists.push({id:e,name:s,createdTime:d}),localStorage.setItem("mahoweek",JSON.stringify(n)),g.append(i(e,s));var l=g.find(".list:last-child");l.find(".list__grid").html(r("list")),l.find(".task__grid").html(r()),l.find(".js-add-task").focus();var o=t(window);l.offset().top>o.scrollTop()+o.height()-30-80&&t("body").scrollTop(l.offset().top)})}(),function(){g.on("keyup change",".js-edit-list",function(e){var a=t(this),s=a.parents(".list").attr("data-id"),i=a.val(),d=JSON.parse(localStorage.getItem("mahoweek")),n=d.lists.filter(function(t){return t.id==s}),r=d.lists.indexOf(n[0]);d.lists[r].name=i,localStorage.setItem("mahoweek",JSON.stringify(d)),13==e.keyCode&&a.blur()})}(),function(){g.on("click",".js-remove-list",function(){var a=t(this),s=a.parents(".list").attr("data-id"),i=a.parents(".list").find(".task:not(.task--add)").length;if(i)var d=confirm("При удалении списка, все дела, находящиеся в нём, так же будут удалены.");if(!i||d){var n=JSON.parse(localStorage.getItem("mahoweek")),r=n.lists.filter(function(t){return t.id==s}),l=n.lists.indexOf(r[0]);if(n.lists.splice(l,1),i){for(var o=[],c=0;c<n.tasks.length;c++)n.tasks[c].listId!=s&&o.push(n.tasks[c]);n.tasks=o}localStorage.setItem("mahoweek",JSON.stringify(n)),a.parents(".list").remove(),e()}})}(),function(){var t=l?200:0;Sortable.create(document.querySelector(".board__lists"),{delay:t,animation:0,handle:".list__name",filter:".list__input",preventOnFilter:!1,ghostClass:"list--ghost",chosenClass:"list--chosen",dragClass:"list--drag",scrollSensitivity:80,onClone:function(){g.addClass("board__lists--drag")},onEnd:function(t){if(Number.isInteger(t.oldIndex)&&Number.isInteger(t.newIndex)&&t.oldIndex>=0&&t.newIndex>=0&&t.oldIndex!=t.newIndex){var e=JSON.parse(localStorage.getItem("mahoweek"));if(void 0!==e.lists[t.oldIndex]&&void 0!==e.lists[t.newIndex]){var a=e.lists.splice(t.oldIndex,1)[0];e.lists.splice(t.newIndex,0,a),localStorage.setItem("mahoweek",JSON.stringify(e))}else location.reload()}g.removeClass("board__lists--drag")}})}(),function(){for(var t=JSON.parse(localStorage.getItem("mahoweek")),a=0;a<t.tasks.length;a++){g.find('.list[data-id="'+t.tasks[a].listId+'"] .task--add').before(n(t.tasks[a].id,t.tasks[a].name,t.tasks[a].completed,t.tasks[a].markers));var i=g.find('.task[data-id="'+t.tasks[a].id+'"]');i.find(".grid__date.grid__date--past.grid__date--bull:not(.grid__date--completed)").length&&!i.find(".grid__date.grid__date--today.grid__date--completed").length&&i.find(".grid__date.grid__date--past.grid__date--bull:not(.grid__date--completed):last").index()>i.find(".grid__date.grid__date--past.grid__date--completed:last").index()&&i.addClass("task--past"),i.find(".grid__date:not(.grid__date--past):not(.grid__date--completed).grid__date--bull").length&&i.addClass("task--bull"),i.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length&&i.addClass("task--today")}for(var a=0;a<t.lists.length;a++)s(t.lists[a].id);"#welcome"!=window.location.hash&&o.addClass("board--load"),e()}(),function(){g.find(".js-add-task").focusin(function(){var e=t(this);e.parents(".task--add").addClass("task--focus")}),g.find(".js-add-task").focusout(function(){var e=t(this);e.parents(".task--add").removeClass("task--focus")})}(),function(){g.on("change",".js-add-task",function(){var e=t(this),i=e.parents(".list").attr("data-id"),d=e.val(),r=(new Date).getTime(),l=a(),o=JSON.parse(localStorage.getItem("mahoweek"));o.tasks.push({id:l,listId:i,name:d,createdTime:r}),localStorage.setItem("mahoweek",JSON.stringify(o)),e.val(""),e.parents(".task--add").before(n(l,d)),s(i);var c=e.parents(".task--add").prev(),g=t(window);c.offset().top>g.scrollTop()+g.height()-30-40-39&&t("body").scrollTop(g.scrollTop()+c.outerHeight(!0))})}(),function(){g.on("click",".js-completed-task",function(){var a=t(this),i=a.parents(".task"),d=i.parents(".list").attr("data-id"),n=i.attr("data-id"),r=i.hasClass("task--completed"),l=i.find(".grid__date--today").attr("data-date"),o=JSON.parse(localStorage.getItem("mahoweek")),c=o.tasks.filter(function(t){return t.id==n}),g=o.tasks.indexOf(c[0]);if(r){i.find(".grid__date--today").removeClass("grid__date--completed");var f="del";delete o.tasks[g].completed,delete o.tasks[g].completedTime,i.removeClass("task--completed")}else{if(i.find(".grid__date--today").toggleClass("grid__date--completed"),i.find(".grid__date--today").hasClass("grid__date--completed"))var f="add";else var f="del";if(i.find(".grid__date--today").hasClass("grid__date--bull")&&!i.find(".grid__date--today").nextAll(".grid__date--bull").length||!i.find(".grid__date--today").hasClass("grid__date--bull")&&i.find(".grid__date--today").nextAll(".grid__date--bull").length<=1){i.find(".grid__date--today").addClass("grid__date--completed"),f="add";var m=(new Date).getTime();o.tasks[g].completed=1,o.tasks[g].completedTime=m,i.addClass("task--completed")}}if(i.find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length?i.addClass("task--today"):i.removeClass("task--today"),"add"!=f||o.tasks[g].markers){var u=o.tasks[g].markers.filter(function(t){return t.date==l});if(""!=u){var _=o.tasks[g].markers.indexOf(u[0]);"add"==f?o.tasks[g].markers[_].completed=1:o.tasks[g].markers[_].label?delete o.tasks[g].markers[_].completed:o.tasks[g].markers.splice(_,1)}else"add"==f&&o.tasks[g].markers.push({date:l,completed:1})}else o.tasks[g].markers=[{date:l,completed:1}];localStorage.setItem("mahoweek",JSON.stringify(o)),s(d),e()})}(),function(){g.on("keyup change",".js-edit-task",function(e){var a=t(this),s=a.parents(".task").attr("data-id"),i=a.val(),d=JSON.parse(localStorage.getItem("mahoweek")),n=d.tasks.filter(function(t){return t.id==s}),r=d.tasks.indexOf(n[0]);d.tasks[r].name=i,localStorage.setItem("mahoweek",JSON.stringify(d)),13==e.keyCode&&a.blur()})}(),function(){g.on("click",".js-remove-task",function(){var a=t(this),i=a.parents(".list").attr("data-id"),d=a.parents(".task").attr("data-id"),n=JSON.parse(localStorage.getItem("mahoweek")),r=n.tasks.filter(function(t){return t.id==d}),l=n.tasks.indexOf(r[0]);n.tasks.splice(l,1),localStorage.setItem("mahoweek",JSON.stringify(n)),a.parents(".task").remove(),s(i),e()})}(),function(){g.on("click",".task:not(.task--completed) .js-marker-task:not(.grid__date--past):not(.grid__date--completed)",function(){var a=t(this),s=a.parents(".task").attr("data-id"),i=a.attr("data-date"),d=JSON.parse(localStorage.getItem("mahoweek")),n=d.tasks.filter(function(t){return t.id==s}),r=d.tasks.indexOf(n[0]);if(d.tasks[r].markers){var l=d.tasks[r].markers.filter(function(t){return t.date==i});if(""!=l){var o=d.tasks[r].markers.indexOf(l[0]);d.tasks[r].markers.splice(o,1),a.removeClass("grid__date--bull")}else d.tasks[r].markers.push({date:i,label:"bull"}),a.addClass("grid__date--bull")}else d.tasks[r].markers=[{date:i,label:"bull"}],a.addClass("grid__date--bull");a.parents(".task").find(".grid__date.grid__date--past.grid__date--bull:not(.grid__date--completed)").length&&!a.parents(".task").find(".grid__date.grid__date--today.grid__date--completed").length&&a.parents(".task").find(".grid__date.grid__date--past.grid__date--bull:not(.grid__date--completed):last").index()>a.parents(".task").find(".grid__date.grid__date--past.grid__date--completed:last").index()?a.parents(".task").addClass("task--past"):a.parents(".task").removeClass("task--past"),a.parents(".task").find(".grid__date:not(.grid__date--past):not(.grid__date--completed).grid__date--bull").length?a.parents(".task").addClass("task--bull"):a.parents(".task").removeClass("task--bull"),a.parents(".task").find(".grid__date--today.grid__date--bull:not(.grid__date--completed)").length?a.parents(".task").addClass("task--today"):a.parents(".task").removeClass("task--today"),localStorage.setItem("mahoweek",JSON.stringify(d)),e()})}(),function(){f.on("submit",function(t){t.preventDefault()});var t=JSON.parse(localStorage.getItem("mahoweek")),e=t.settings.theme;f.find('.js-choose-theme[value="'+e+'"]').attr("checked","checked"),f.find(":checkbox, :radio").on("change",function(){e=f.find('.js-choose-theme[name="theme"]:checked').val(),c.attr("class","board__theme  board__theme--"+e),t.settings.theme=e,localStorage.setItem("mahoweek",JSON.stringify(t))})}()}(jQuery);